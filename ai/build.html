<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能开启 | ruoyi-vue-pro 开发指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .source-url {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        .content-wrapper {
            line-height: 1.8;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            background: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>功能开启 | ruoyi-vue-pro 开发指南</h1>
        <div class="source-url">原始链接: <a href="https://doc.iocoder.cn/ai/build/">https://doc.iocoder.cn/ai/build/</a></div>
    </div>
    <div class="content-wrapper">
        <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">功能开启<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">进度说明：</p> <ul><li>管理后台，请使用 <a href="https://gitee.com/yudaocode/yudao-ui-admin-vue3" target="_blank" rel="noopener noreferrer">https://gitee.com/yudaocode/yudao-ui-admin-vue3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 仓库的 <code>master</code> 分支</li> <li>后端项目，请使用 <a href="https://gitee.com/zhijiantianya/ruoyi-vue-pro" target="_blank" rel="noopener noreferrer">https://gitee.com/zhijiantianya/ruoyi-vue-pro<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 仓库的 <code>master-jdk17</code> 分支</li></ul> <p>注意！仅支持 JDK 17/21 使用，因为基于 <a href="https://spring.io/projects/spring-ai" target="_blank" rel="noopener noreferrer">Spring AI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现，它基于 Spring Boot 3.X 构建，所以最低要求 JDK 17！！！</p></div> <p>AI 系统，后端由 <code>yudao-module-ai</code> 模块实现，前端由 <code>yudao-ui-admin-vue3</code> 的 <code>ai</code> 目录实现。</p> <p>考虑到编译速度，默认 <code>yudao-module-ai</code> 模块是关闭的，需要手动开启。步骤如下：</p> <ul><li>第一步，开启 <code>yudao-module-ai</code> 模块</li> <li>第二步，导入 AI 系统的 SQL 数据库脚本</li> <li>第三步，重启后端项目，确认功能是否生效</li></ul> <h2 id="_1-第一步-开启模块"><a href="#_1-%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%BC%80%E5%90%AF%E6%A8%A1%E5%9D%97" class="header-anchor">#</a> 1. 第一步，开启模块</h2> <p>① 修改根目录的 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/pom.xml" target="_blank" rel="noopener noreferrer"><code>pom.xml</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文件，取消 <code>yudao-module-ai</code> 模块的注释。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/%E5%8A%9F%E8%83%BD%E5%BC%80%E5%90%AF/%E7%AC%AC%E4%B8%80%E6%AD%A5-01.png" alt="取消  模块的注释"></p> <p>② 修改 <code>yudao-server</code> 目录的 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-server/pom.xml" target="_blank" rel="noopener noreferrer"><code>pom.xml</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文件，引入 <code>yudao-module-ai</code> 模块。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/%E5%8A%9F%E8%83%BD%E5%BC%80%E5%90%AF/%E7%AC%AC%E4%B8%80%E6%AD%A5-02.png" alt="引入  模块"></p> <p>③ 点击 IDEA 右上角的【Reload All Maven Projects】，刷新 Maven 依赖。如下图所示：</p> <p><img src="/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%8A%9F%E8%83%BD%E5%BC%80%E5%90%AF/%E7%AC%AC%E4%B8%80%E6%AD%A5-03.png" alt="刷新 Maven 依赖"></p> <h2 id="_2-第二步-导入-sql"><a href="#_2-%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E5%AF%BC%E5%85%A5-sql" class="header-anchor">#</a> 2. 第二步，导入 SQL</h2> <p>点击 <a href="https://t.zsxq.com/09F92" target="_blank" rel="noopener noreferrer"><code>ai-2024-07-07.sql.zip</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下载附件，解压出 SQL 文件，然后导入到数据库中。</p> <p>所以表名字，都使用 <code>ai_</code> 作为前缀。</p> <h2 id="_3-第三步-重启项目"><a href="#_3-%E7%AC%AC%E4%B8%89%E6%AD%A5-%E9%87%8D%E5%90%AF%E9%A1%B9%E7%9B%AE" class="header-anchor">#</a> 3. 第三步，重启项目</h2> <p>重启后端项目，然后访问前端的 AI 菜单，确认功能是否生效。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA/%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0.png" alt="确认功能是否生效"></p> <p>至此，我们就成功开启了 AI 的功能 🙂</p> <p>可以访问 [AI 大模型 -&gt; AI 对话] 菜单，点击左上角的【新建对话】按钮后，确认右上角的模型是“deepseek”后，就可以和 AI 大模型聊起来了！</p> <div class="custom-block tip"><p class="custom-block-title">友情提示：</p> <p>如果聊天报错，可能是 API 密钥配置不正确，或者 API 密钥欠费了，可以参考下面的「666. 使用必读」小节，配置你自己申请的密钥。</p></div> <h2 id="_4-使用必读"><a href="#_4-%E4%BD%BF%E7%94%A8%E5%BF%85%E8%AF%BB" class="header-anchor">#</a> 4. 使用必读！！！</h2> <p>目前 AI 系统下的功能，是基于 <a href="https://www.redhat.com/zh/topics/ai/what-are-large-language-models" target="_blank" rel="noopener noreferrer">LLM 大模型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，从而实现对话、绘图等一系列功能。</p> <p>使用时，需要进行 API 密钥、模型的配置。下面，我们来了解下。</p> <h3 id="_4-1-api-秘钥表"><a href="#_4-1-api-%E7%A7%98%E9%92%A5%E8%A1%A8" class="header-anchor">#</a> 4.1 API 秘钥表</h3> <p><code>ai_api_key</code>：API 秘钥表，顾名思义，就是存储 AI 大模型的 API 密钥的表。</p> <h4 id="_4-1-1-表结构"><a href="#_4-1-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 4.1.1 表结构</h4> <blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>ai_api_key<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'名称'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>platform<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'平台'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>api_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密钥'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>url<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'自定义 API 地址'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'状态'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">7</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'AI API 密钥表'</span><span class="token punctuation">;</span>
</code></pre></div><p>① <code>platform</code> 字段：表示平台，对应 AiPlatformEnum 枚举，目前支持多个 AI 大模型：</p> <ul><li>国内：【阿里】通义千问、【深度求索】DeepSeek、【字节】豆包、【腾讯】混元、【百度】文心一言、【SiliconFlow】硅基流动、【讯飞】星火、【智谱】GLM</li> <li>国外：【OpenAI】GPT、【Meta】Llama、【Google】Gemini、【Stability】Stable Diffusion</li></ul> <p>通过 <code>platform</code> 字段，可以区分不同的平台，从而创建对应的 Spring AI Model 对象，调用对应的平台，具体可见 AiModelFactoryImpl 类下的一系列方法。</p> <p>② <code>api_key</code> 字段：表示 API 密钥，对应不同的平台的密钥，例如说 OpenAI 的 API KEY。但是要注意，有些平台是多个值，例如说文心一言是 <code>appKey</code> + <code>secretKey</code> 组合，那它在 <code>api_key</code> 就是 <code>${appKey}|${secretKey}</code>。</p> <p><code>url</code> 字段：表示自定义 API 地址。一般情况下不需要配置，除非你有自定义的需求，例如说 OpenAI 使用 API 中转。</p> <p>具体它们怎么配置，或者怎么部署，可见对应的文档：</p> <ul><li>国内模型：<a href="/ai/tongyi">《通义千问》</a>、<a href="/ai/deep-seek">《DeepSeek》</a>、<a href="/ai/doubao">《豆包》</a>、<a href="/ai/hunyuan">《混元》</a>、<a href="/ai/yiyan">《文心一言》</a>、<a href="/ai/siliconflow">《硅基流动》</a>、<a href="/ai/xinghuo">《讯飞星火》</a>、<a href="/ai/glm">《智谱 GLM》</a>、<a href="/ai/moonshot">《月之暗灭》</a>、<a href="/ai/minimax">《MiniMax》</a>、<a href="/ai/baichuan">《百川智能》</a></li> <li>国外模型：<a href="/ai/openai">《OpenAI（ChatGPT）》</a>、<a href="/ai/llama">《LLAMA》</a>、<a href="/ai/azure-openai">《微软 OpenAI（ChatGPT）》</a>、<a href="/ai/gemini">《谷歌 Gemini》</a></li></ul> <div class="custom-block tip"><p class="custom-block-title">友情提示：</p> <p>一般情况下，建议先使用 <a href="/ai/deep-seek">《DeepSeek》</a> 模型，因为免费送了一些 tokens，可以先体验一下。</p></div> <h4 id="_4-1-2-管理后台"><a href="#_4-1-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0" class="header-anchor">#</a> 4.1.2 管理后台</h4> <p>前端对应 [AI 大模型 -&gt; 控制台 -&gt; API 密钥] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/ai/model/apiKey</code> 目录。</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E9%85%8D%E7%BD%AE/API%E5%AF%86%E9%92%A5.png" alt="API 密钥"></p> <p>它的后端 HTTP 接口，由 <code>yudao-module-ai</code> 模块的 <code>model</code> 包的 AiApiKeyController 实现。</p> <h3 id="_4-2-模型表"><a href="#_4-2-%E6%A8%A1%E5%9E%8B%E8%A1%A8" class="header-anchor">#</a> 4.2 模型表</h3> <p><code>ai_model</code>：模型表，配置每个平台下有哪些可用的模型。</p> <h4 id="_4-2-1-表结构"><a href="#_4-2-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 4.2.1 表结构</h4> <blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>ai_model<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'模型名字'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sort<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'排序'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'状态'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>key_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'API 秘钥编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>platform<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'模型平台'</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>model<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'模型标识'</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>temperature<span class="token punctuation">`</span></span> <span class="token keyword">double</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'温度参数'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>max_tokens<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'单条回复的最大 Token 数量'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>max_contexts<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'上下文的最大 Message 数量'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">15</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'AI 模型表'</span><span class="token punctuation">;</span>
</code></pre></div><p>① <code>key_id</code> 字段：表示 API 秘钥编号，对应 <code>ai_api_key</code> 表的 <code>id</code> 字段。</p> <p><code>platform</code> 字段：表示模型平台，冗余 <code>ai_api_key</code> 表的 <code>platform</code> 字段。</p> <p>② <code>model</code> 字段：表示模型标识，对应不同的平台的模型标识，例如说 OpenAI 的 <code>gpt-3.5-turbo</code>、<code>gpt-4-turbo</code>，通义千问的 <code>qwen-plus</code>、<code>qwen-max</code> 等等。</p> <p>③ <code>type</code> 字段：模型类型，对应 AiModelTypeEnum 枚举，对应有 CHAT、IMAGE、VOICE、VIDEO、EMBEDDING、RERANK 等。</p> <p>例如说，CHAT 可用于文本生成，IMAGE 可用于图片生成，VOICE 可用于语音生成，VIDEO 可用于视频生成。</p> <p>④ <code>temperature</code> 字段：表示温度参数，对应不同的平台的温度参数，例如说 OpenAI 的 <code>temperature</code>。</p> <p><code>max_tokens</code> 字段：表示单条回复的最大 Token 数量，对应不同的平台的最大 Token 数量，例如说 OpenAI 的 <code>gpt-3.5-turbo</code> 为 4096，<code>gpt-4</code> 为 8192。</p> <p><code>max_contexts</code> 字段：表示上下文的最大 Message 数量。因为模型的上下文是有上限的，所以和模型对话时，不会把历史的所有消息都发送过去，而是选择最近的 <code>max_contexts</code> 组消息。会有一些难理解，具体可以看看 AiChatMessageServiceImpl 的 <code>#filterContextMessages(...)</code> 方法。</p> <div class="custom-block tip"><p class="custom-block-title">疑问：为什么 ai_api_key 和 ai_chat_model 表是分开的？</p> <p>一个平台有多个模型，它们会共用一个 API 密钥，所以是分开的，方便管理。</p></div> <h4 id="_4-2-2-管理后台"><a href="#_4-2-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0" class="header-anchor">#</a> 4.2.2 管理后台</h4> <p>前端对应 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/ai/model/model</code> 目录。</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E9%85%8D%E7%BD%AE/%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE.png" alt="模型配置"></p> <p>它的后端 HTTP 接口，由 <code>yudao-module-ai</code> 模块的 <code>model</code> 包的 AiModelController 实现。</p> <p>注意：新建模型时，需要正确选择 <code>type</code> 模型类型，否则会导致调用不到对应的模型！！！</p></div></div>
    </div>
</body>
</html>