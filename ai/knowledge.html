<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 知识库 | ruoyi-vue-pro 开发指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .source-url {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        .content-wrapper {
            line-height: 1.8;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            background: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>AI 知识库 | ruoyi-vue-pro 开发指南</h1>
        <div class="source-url">原始链接: <a href="https://doc.iocoder.cn/ai/knowledge/">https://doc.iocoder.cn/ai/knowledge/</a></div>
    </div>
    <div class="content-wrapper">
        <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">AI 知识库<!----></h1>  <div class="theme-vdoing-content content__default"><p>AI 知识库，基于 RAG 方式，实现 LLM 打通内部知识库。</p> <div class="custom-block tip"><p class="custom-block-title">疑问：什么是 RAG？</p> <ul><li><a href="https://www.zhihu.com/tardis/zm/art/675509396" target="_blank" rel="noopener noreferrer">《一文读懂：大模型 RAG（检索增强生成）含高级方法》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.promptingguide.ai/zh/techniques/rag" target="_blank" rel="noopener noreferrer">《检索增强生成 (RAG)》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.redhat.com/zh/topics/ai/what-is-retrieval-augmented-generation" target="_blank" rel="noopener noreferrer">《什么是检索增强生成？》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>目前，项目中的 <a href="/ai/chat/">AI 聊天对话</a> 功能，已经接入 AI 知识库，如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%A1%88%E4%BE%8B.png" alt="AI 知识库的案例"></p> <p>整个功能，涉及到 3 个表：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%A1%A8%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="表关系图"></p> <ul><li><code>ai_knowledge</code>：AI 知识库表</li> <li><code>ai_knowledge_document</code>：AI 知识库文档表</li> <li><code>ai_knowledge_segment</code>：AI 知识库段落表</li></ul> <p>下面，我们逐个表进行介绍，这个过程中也会讲讲对应的功能。</p> <h2 id="_1-ai-知识库表"><a href="#_1-ai-%E7%9F%A5%E8%AF%86%E5%BA%93%E8%A1%A8" class="header-anchor">#</a> 1. AI 知识库表</h2> <p><code>ai_knowledge</code> 表，是 AI 知识库的主表，存储了知识库的基本信息。</p> <h3 id="_1-1-表结构"><a href="#_1-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 1.1 表结构</h3> <blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>ai_knowledge<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'知识库名称'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>description<span class="token punctuation">`</span></span> <span class="token keyword">longtext</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">COMMENT</span> <span class="token string">'知识库描述'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>embedding_model_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'向量模型编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>embedding_model<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'向量模型标识'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>top_k<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'topK'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>similarity_threshold<span class="token punctuation">`</span></span> <span class="token keyword">double</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'相似度阈值'</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否启用'</span><span class="token punctuation">,</span>

  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">6</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'AI 知识库表'</span><span class="token punctuation">;</span>
</code></pre></div><p>① <code>embedding_model_id</code> 字段：对应 <code>ai_model</code> 表的 <code>id</code> 字段，表示使用的向量模型。</p> <div class="custom-block tip"><p class="custom-block-title">友情提示：向量模型的配置，可见「附录：向量模型」小节。</p></div> <p>② <code>top_k</code> 字段：表示检索时，返回的最大数量。</p> <p><code>similarity_threshold</code> 字段：表示相似度阈值，超过这个值，检索才会返回。</p> <h3 id="_1-2-管理后台"><a href="#_1-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0" class="header-anchor">#</a> 1.2 管理后台</h3> <p>① 前端对应 [AI 大模型 -&gt; AI 知识库] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/ai/knowledge/knowledge</code> 目录，创建知识库。</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93.png" alt="AI 知识库"></p> <p>它的后端 HTTP 接口，由 <code>yudao-module-ai</code> 模块的 <code>model</code> 包的 AiKnowledgeController 实现。</p> <p>② 点击「新建」按钮，填写知识库名称、描述、向量模型、topK、相似度阈值，点击「保存」按钮，即可创建知识库。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%96%B0%E5%BB%BA.png" alt="AI 知识库新建"></p> <h2 id="_2-ai-知识库文档表"><a href="#_2-ai-%E7%9F%A5%E8%AF%86%E5%BA%93%E6%96%87%E6%A1%A3%E8%A1%A8" class="header-anchor">#</a> 2. AI 知识库文档表</h2> <p><code>ai_knowledge_document</code> 表，是 AI 知识库的文档表，存储了知识库的文档信息。</p> <h3 id="_2-1-表结构"><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 2.1 表结构</h3> <blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>ai_knowledge_document<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>knowledge_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'知识库编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文档名称'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>url<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件 URL'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>content<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'内容'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>content_length<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'字符数'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>tokens<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'token 数量'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>segment_max_tokens<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'分片最大 Token 数'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>retrieval_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'召回次数'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否启用'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">23</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'AI 知识库文档表'</span><span class="token punctuation">;</span>
</code></pre></div><p>① <code>knowledge_id</code> 字段：对应 <code>ai_knowledge</code> 表的 <code>id</code> 字段，表示属于哪个知识库。</p> <p>② <code>url</code> 字段：通过上传文件，新建文档时，会有文件 URL。</p> <p><code>content</code>、<code>content_length</code>、<code>tokens</code> 字段：表示文档内容、字符数、token 数量。</p> <p>③ <code>segment_max_tokens</code> 字段：表示分片最大 Token 数，超过这个值，会进行分片。目前通过 Spring AI 提供的 TokenTextSplitter 进行分片。</p> <p>④ <code>retrieval_count</code> 字段：表示召回次数，每次检索时，会记录召回次数。</p> <h3 id="_2-2-管理后台"><a href="#_2-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0" class="header-anchor">#</a> 2.2 管理后台</h3> <p>① 点击“知识库”所在列的「文档」按钮，进入该知识库的文档列表，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/ai/knowledge/knowledge</code> 目录，如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%96%87%E6%A1%A3.png" alt="AI 知识库文档"></p> <p>它的后端 HTTP 接口，由 <code>yudao-module-ai</code> 模块的 <code>model</code> 包的 AiKnowledgeDocumentController 实现。</p> <p>② 点击「新建」按钮，上传文件（支持多个），不断点击「下一步」按钮，即可创建文档。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%96%87%E6%A1%A3%E6%96%B0%E5%BB%BA.png" alt="AI 知识库文档新建"></p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%96%87%E6%A1%A3%E6%96%B0%E5%BB%BA2.png" alt="AI 知识库文档新建2"></p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%96%87%E6%A1%A3%E6%96%B0%E5%BB%BA3.png" alt="AI 知识库文档新建3"></p> <p>完成后，文档会被切成多个分片，之后分片使用【向量模型】进行向量化，最终存储到【向量存储】中。</p> <div class="custom-block tip"><p class="custom-block-title">友情提示：向量存储的配置，可见「附录：向量存储」小节。</p></div> <h2 id="_3-ai-知识库段落表"><a href="#_3-ai-%E7%9F%A5%E8%AF%86%E5%BA%93%E6%AE%B5%E8%90%BD%E8%A1%A8" class="header-anchor">#</a> 3. AI 知识库段落表</h2> <p><code>ai_knowledge_segment</code> 表，是 AI 知识库的段落表，存储了知识库的段落信息。</p> <p>也就是说，切片一方面存储到【向量存储】中（用于“检索”），另一方面存储到 <code>ai_knowledge_segment</code> 表中（用于“管理”）。</p> <h3 id="_3-1-表结构"><a href="#_3-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 3.1 表结构</h3> <blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>ai_knowledge_segment<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>knowledge_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'知识库编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>document_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文档编号'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>content<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'分段内容'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>content_length<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'字符数'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>tokens<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'token 数量'</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>vector_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'向量库的编号'</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>retrieval_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'召回次数'</span><span class="token punctuation">,</span>
  
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否启用'</span><span class="token punctuation">,</span>

  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">183</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'AI 知识库分段表'</span><span class="token punctuation">;</span>
</code></pre></div><p>① <code>knowledge_id</code> 字段：对应 <code>ai_knowledge</code> 表的 <code>id</code> 字段，表示属于哪个知识库。</p> <p><code>document_id</code> 字段：对应 <code>ai_knowledge_document</code> 表的 <code>id</code> 字段，表示属于哪个文档。</p> <p>② <code>content</code>、<code>content_length</code>、<code>tokens</code> 字段：表示分段内容、字符数、token 数量。</p> <p>③ <code>vector_id</code> 字段：表示向量库的编号，对应【向量存储】中的向量编号。只做关联，不存储向量值。</p> <p>④ <code>retrieval_count</code> 字段：表示召回次数，每次检索时，会记录召回次数。</p> <h3 id="_3-2-管理后台"><a href="#_3-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0" class="header-anchor">#</a> 3.2 管理后台</h3> <p>① 点击“文档”所在列的「文档」按钮，进入该知识库的文档列表，点击「查看」按钮，即可查看文档的分段列表，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/ai/knowledge/knowledge</code> 目录，如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%AE%B5%E8%90%BD.png" alt="AI 知识库段落"></p> <p>② 除了上述文档的方式，我们也可以点击「新建」或者「编辑」按钮，手动创建或编辑段落。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%AE%B5%E8%90%BD%E6%96%B0%E5%BB%BA.png" alt="AI 知识库段落新建"></p> <h2 id="_4-如何使用"><a href="#_4-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" class="header-anchor">#</a> 4. 如何使用？</h2> <h3 id="_4-1-召回测试"><a href="#_4-1-%E5%8F%AC%E5%9B%9E%E6%B5%8B%E8%AF%95" class="header-anchor">#</a> 4.1 召回测试</h3> <p>可以在 [AI 大模型 -&gt; AI 知识库] 菜单，点击“知识库”所在列的「召回测试」按钮，输入检索内容，即可测试知识库的检索。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E5%8F%AC%E5%9B%9E%E6%B5%8B%E8%AF%95.png" alt="AI 知识库召回测试"></p> <h3 id="_4-2-接入-ai-聊天"><a href="#_4-2-%E6%8E%A5%E5%85%A5-ai-%E8%81%8A%E5%A4%A9" class="header-anchor">#</a> 4.2 接入 AI 聊天</h3> <p>① 第一步，在角色配置时，关联对应的 AI 知识库，可多选。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E8%A7%92%E8%89%B2%E9%85%8D%E7%BD%AE.png" alt="AI 知识库角色配置"></p> <p>② 第二步，使用该角色进行聊天，即可使用 AI 知识库。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%A1%88%E4%BE%8B.png" alt="AI 知识库的案例"></p> <h2 id="附录-向量模型"><a href="#%E9%99%84%E5%BD%95-%E5%90%91%E9%87%8F%E6%A8%A1%E5%9E%8B" class="header-anchor">#</a> 附录：向量模型</h2> <p>在 Spring AI 中，通过 EmbeddingModel 接口，实现了各个平台的向量模型的接入。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/EmbeddingModel.png" alt="EmbeddingModel 实现"></p> <p>目前在项目的 AiModelFactoryImpl 中，提供了 <code>#getOrCreateEmbeddingModel(...)</code> 方法：</p> <ul><li>已实现 OllamaEmbeddingModel、DashScopeEmbeddingModel 模型的接入</li> <li>未实现的其它平台的向量模型，可参考实现到上述方法中</li></ul> <h3 id="ollamaembeddingmodel"><a href="#ollamaembeddingmodel" class="header-anchor">#</a> OllamaEmbeddingModel</h3> <p>① 首先，访问 <a href="https://ollama.ai/download" target="_blank" rel="noopener noreferrer">https://ollama.ai/download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，下载对应系统 Ollama 客户端，然后安装。</p> <p>② 然后，访问 <a href="https://ollama.com/search?c=embedding" target="_blank" rel="noopener noreferrer">https://ollama.com/search?c=embedding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 地址，获取想运行的向量模型。</p> <p>例如说：<code>nomic-embed-text</code>，则可在命令中执行 <code>ollama pull nomic-embed-text</code> 命令，进行一键部署。</p> <p>③ 最后，在 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，添加该向量模型。</p> <p>注意，模型名使用你 Ollama 部署的模型名。</p> <h3 id="dashscopeembeddingmodel"><a href="#dashscopeembeddingmodel" class="header-anchor">#</a> DashScopeEmbeddingModel</h3> <p>① 首先，参考 <a href="/ai/tongyi">《【模型接入】通义千问》</a> 文档，申请对应的 API 密钥。</p> <p>② 然后，在 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，添加该向量模型。</p> <p>模型名，可使用 <code>text_embedding_v3</code>，更多可参考 <a href="https://help.aliyun.com/zh/model-studio/developer-reference/general-text-embedding/" target="_blank" rel="noopener noreferrer">《阿里云 —— 通用文本向量》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="zhipuaiembeddingmodel"><a href="#zhipuaiembeddingmodel" class="header-anchor">#</a> ZhiPuAiEmbeddingModel</h3> <p>① 首先，参考 <a href="/ai/glm">《【模型接入】智普 GLM》</a> 文档，申请智普 AI 的 API 密钥。</p> <p>② 然后，在 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，添加该向量模型。</p> <p>模型名，可使用 <code>embedding-3</code>，更多可参考 <a href="https://bigmodel.cn/console/modelcenter/square" target="_blank" rel="noopener noreferrer">《智谱 —— 模型广场》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 搜 “embedding” 关键字。</p> <h3 id="qianfanembeddingmodel"><a href="#qianfanembeddingmodel" class="header-anchor">#</a> QianFanEmbeddingModel</h3> <p>① 首先，参考 <a href="/ai/qianfan">《【模型接入】文心一言》</a> 文档，申请对应的 API 密钥。</p> <p>② 然后，在 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，添加该向量模型。</p> <p>模型名，可使用 <code>embedding-v1</code>，更多可参考 <a href="https://cloud.baidu.com/doc/WENXINWORKSHOP/s/om6070n97" target="_blank" rel="noopener noreferrer">《千帆大模型服务 —— 向量Embeddings》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="moonshotembeddingmodel"><a href="#moonshotembeddingmodel" class="header-anchor">#</a> MoonshotEmbeddingModel</h3> <p>① 首先，参考 <a href="/ai/moonshot">《【模型接入】Moonshot》</a> 文档，申请对应的 API 密钥。</p> <p>② 然后，在 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，添加该向量模型。</p> <p>模型名，可使用 <code>embo-01</code>，更多可参考 <a href="https://platform.minimaxi.com/document/embeddings?key=66718fbfa427f0c8a5701627" target="_blank" rel="noopener noreferrer">《Moonshot 文档 —— Embeddings（向量化）》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="openaiembeddingmodel"><a href="#openaiembeddingmodel" class="header-anchor">#</a> OpenAiEmbeddingModel</h3> <p>① 首先，参考 <a href="/ai/openai">《【模型接入】OpenAI》</a> 文档，申请对应的 API 密钥。</p> <p>② 然后，在 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，添加该向量模型。</p> <p>模型名，可使用 <code>text-embedding-ada-002</code>，TODO 更多可参考 <a href="https://openai.xiniushu.com/docs/guides/embeddings" target="_blank" rel="noopener noreferrer">《OpenAI 中文文档 —— 嵌入模型》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="azureopenaiembeddingmodel"><a href="#azureopenaiembeddingmodel" class="header-anchor">#</a> AzureOpenAiEmbeddingModel</h3> <p>① 首先，参考 <a href="/ai/azure-openai">《【模型接入】微软 OpenAI》</a> 文档，申请对应的 API 密钥。</p> <p>② 然后，在 [AI 大模型 -&gt; 控制台 -&gt; 模型配置] 菜单，添加该向量模型。</p> <p>模型名，可使用 <code>text-embedding-3-small</code>，更多可参考 <a href="https://learn.microsoft.com/zh-cn/azure/ai-services/openai/tutorials/embeddings" target="_blank" rel="noopener noreferrer">《教程：探索 Azure OpenAI 服务嵌入和文档搜索》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="附录-向量存储"><a href="#%E9%99%84%E5%BD%95-%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8" class="header-anchor">#</a> 附录：向量存储</h2> <p>在 Spring AI 中，通过 VectorStore 接口，实现了各个平台的向量存储的接入。如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/VectorStore.png" alt="VectorStore 实现"></p> <p>目前在项目的 AiModelFactoryImpl 中，提供了 <code>#getOrCreateVectorStore(...)</code> 方法，实现如下模型的接入：</p> <ul><li>本地磁盘 SimpleVectorStore</li> <li><a href="https://redis.io/solutions/vector-database/" target="_blank" rel="noopener noreferrer">Redis<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> RedisVectorStore</li> <li><a href="https://qdrant.tech/" target="_blank" rel="noopener noreferrer">Qdrant<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> QdrantVectorStore</li> <li><a href="https://milvus.io/" target="_blank" rel="noopener noreferrer">Milvus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> MilvusVectorStore</li></ul> <p>ps：其它平台的向量存储，可参考实现到上述方法中。</p> <p>另外，默认使用 SimpleVectorStore。如需切换，可修改 AiModelServiceImpl 的 <code>#getOrCreateVectorStore(...)</code> 方法，如下图所示：</p> <p><img src="/img/AI%E6%89%8B%E5%86%8C/AI%E7%9F%A5%E8%AF%86%E5%BA%93/VectorStore%E5%88%87%E6%8D%A2.png" alt="VectorStore 切换"></p> <h3 id="redisvectorstore"><a href="#redisvectorstore" class="header-anchor">#</a> RedisVectorStore</h3> <p>① 参考 <a href="https://blog.csdn.net/NiDeHaoPengYou/article/details/129748387" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/NiDeHaoPengYou/article/details/129748387<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档，执行 <code>docker run -d --name redis-stack -p 6379:6379 -p 8001:8001 redis/redis-stack:latest</code> 命令，安装开启向量存储的 Redis。</p> <p>② 修改 AiModelServiceImpl 的 <code>#getOrCreateVectorStore(...)</code> 方法，使用 RedisVectorStore。</p> <p>另外，默认在 <code>application.yaml</code> 配置如下：</p> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">ai</span><span class="token punctuation">:</span>
    <span class="token key atrule">vectorstore</span><span class="token punctuation">:</span> <span class="token comment"># 向量存储</span>
      <span class="token key atrule">redis</span><span class="token punctuation">:</span>
        <span class="token key atrule">initialize-schema</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">index</span><span class="token punctuation">:</span> knowledge_index <span class="token comment"># Redis 中向量索引的名称：用于存储和检索向量数据的索引标识符，所有相关的向量搜索操作都会基于这个索引进行</span>
        <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">"knowledge_segment:"</span> <span class="token comment"># Redis 中存储向量数据的键名前缀：这个前缀会添加到每个存储在 Redis 中的向量数据键名前，每个 document 都是一个 hash 结构</span>
</code></pre></div><h3 id="qdrantvectorstore"><a href="#qdrantvectorstore" class="header-anchor">#</a> QdrantVectorStore</h3> <p>① 执行 <code>docker run -d --name qdrant-test -p 6333:6333 -p 6334:6334 qdrant/qdrant:latest</code> 命令，安装 Qdrant。</p> <p>② 修改 AiModelServiceImpl 的 <code>#getOrCreateVectorStore(...)</code> 方法，使用 QdrantVectorStore。</p> <p>另外，默认在 <code>application.yaml</code> 配置如下：</p> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">ai</span><span class="token punctuation">:</span>
    <span class="token key atrule">vectorstore</span><span class="token punctuation">:</span> <span class="token comment"># 向量存储</span>
      <span class="token key atrule">qdrant</span><span class="token punctuation">:</span>
        <span class="token key atrule">initialize-schema</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">collection-name</span><span class="token punctuation">:</span> knowledge_segment <span class="token comment"># Qdrant 中向量集合的名称：用于存储向量数据的集合标识符，所有相关的向量操作都会在这个集合中进行</span>
        <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6334</span>
</code></pre></div><h3 id="milvusvectorstore"><a href="#milvusvectorstore" class="header-anchor">#</a> MilvusVectorStore</h3> <p>① 参考 <a href="https://milvus.io/docs/zh/prerequisite-docker.md" target="_blank" rel="noopener noreferrer">https://milvus.io/docs/zh/prerequisite-docker.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档，执行如下命令（需要翻墙）：</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-sfL</span> https://raw.githubusercontent.com/milvus-io/milvus/master/scripts/standalone_embed.sh <span class="token parameter variable">-o</span> standalone_embed.sh
<span class="token function">bash</span> standalone_embed.sh start
</code></pre></div><p>② 修改 AiModelServiceImpl 的 <code>#getOrCreateVectorStore(...)</code> 方法，使用 MilvusVectorStore。</p> <p>另外，默认在 <code>application.yaml</code> 配置如下：</p> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">ai</span><span class="token punctuation">:</span>
    <span class="token key atrule">vectorstore</span><span class="token punctuation">:</span> <span class="token comment"># 向量存储</span>
      <span class="token key atrule">milvus</span><span class="token punctuation">:</span>
        <span class="token key atrule">initialize-schema</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">database-name</span><span class="token punctuation">:</span> default <span class="token comment"># Milvus 中数据库的名称</span>
        <span class="token key atrule">collection-name</span><span class="token punctuation">:</span> knowledge_segment <span class="token comment"># Milvus 中集合的名称：用于存储向量数据的集合标识符，所有相关的向量操作都会在这个集合中进行</span>
        <span class="token key atrule">client</span><span class="token punctuation">:</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">19530</span>
</code></pre></div><h2 id="常见问题"><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" class="header-anchor">#</a> 常见问题？</h2> <p>① 如果使用本地向量化模型的应用分享？</p> <p>参见 <a href="https://t.zsxq.com/6KM05" target="_blank" rel="noopener noreferrer">https://t.zsxq.com/6KM05<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档。</p> <p>②</p></div></div>
    </div>
</body>
</html>