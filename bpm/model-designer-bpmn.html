<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>流程设计器（BPMN） | ruoyi-vue-pro 开发指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .source-url {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        .content-wrapper {
            line-height: 1.8;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            background: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>流程设计器（BPMN） | ruoyi-vue-pro 开发指南</h1>
        <div class="source-url">原始链接: <a href="https://doc.iocoder.cn/bpm/model-designer-bpmn/">https://doc.iocoder.cn/bpm/model-designer-bpmn/</a></div>
    </div>
    <div class="content-wrapper">
        <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">流程设计器（BPMN）<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">相关视频：</p> <ul><li><a href="https://t.zsxq.com/04iynUF6e" target="_blank" rel="noopener noreferrer">05、如何实现流程模型的新建？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/04rNVbEQB" target="_blank" rel="noopener noreferrer">06、如何实现流程模型的流程图的设计？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/042neybYz" target="_blank" rel="noopener noreferrer">07、如何实现流程模型的流程图的预览？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/04jUBMjyF" target="_blank" rel="noopener noreferrer">09、如何实现流程模型的发布？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/04MF6URvz" target="_blank" rel="noopener noreferrer">10、如何实现流程定义的查询？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/04R72rzzN" target="_blank" rel="noopener noreferrer">21、如何实现流程的流程图的高亮？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>在 <a href="/bpm/use-bpm-form/">《审批接入（流程表单）》</a>、<a href="/bpm/use-business-form/">《审批接入（业务表单）》</a> 小节中，我们已经新建过流程模型，并发布为流程定义，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E7%A4%BA%E4%BE%8B%E6%B5%81%E7%A8%8B.png" alt="示例流程"></p> <p>本文，我们将进一步讲解【<strong>流程模型</strong>】、【<strong>流程定义</strong>】，特别是如何使用 BPMN 流程设计器。</p> <h2 id="_1-流程模型"><a href="#_1-%E6%B5%81%E7%A8%8B%E6%A8%A1%E5%9E%8B" class="header-anchor">#</a> 1. 流程模型</h2> <p>流程模型，对应 [工作流程 -&gt; 流程管理 -&gt; 流程模型] 菜单，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA/%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0.png" alt="流程模型"></p> <ul><li>后端，由 BpmModelController 提供接口</li> <li>前端，由 <code>/views/bpm/model/index.vue</code> 实现界面</li></ul> <h3 id="_1-1-表结构"><a href="#_1-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 1.1 表结构</h3> <p>流程设计模型部署表，由 Flowable 提供的 <code>ACT_RE_MODEL</code> 表实现，如下所示：</p> <table><thead><tr><th>字段名称</th> <th>字段描述</th> <th>数据类型</th> <th>主键</th> <th>为空</th> <th>取值说明</th></tr></thead> <tbody><tr><td>ID_</td> <td>ID_</td> <td>nvarchar(64)</td> <td>√</td> <td></td> <td>ID_</td></tr> <tr><td>REV_</td> <td>乐观锁</td> <td>int</td> <td></td> <td>√</td> <td>乐观锁</td></tr> <tr><td>NAME_</td> <td>名称</td> <td>nvarchar(255)</td> <td></td> <td>√</td> <td>名称</td></tr> <tr><td>KEY_</td> <td>KEY_</td> <td>nvarchar(255)</td> <td></td> <td>√</td> <td>key</td></tr> <tr><td>CATEGORY_</td> <td>分类</td> <td>nvarchar(255)</td> <td></td> <td>√</td> <td>分类</td></tr> <tr><td>CREATE_TIME_</td> <td>创建时间</td> <td>datetime</td> <td></td> <td>√</td> <td>创建时间</td></tr> <tr><td>LAST_UPDATE_TIME_</td> <td>最新修改时间</td> <td>datetime</td> <td></td> <td>√</td> <td>最新修改时间</td></tr> <tr><td>VERSION_</td> <td>版本</td> <td>int</td> <td></td> <td>√</td> <td>版本</td></tr> <tr><td>META_INFO_</td> <td>META_INFO_</td> <td>nvarchar(255)</td> <td></td> <td>√</td> <td>以 json 格式保存流程定义的信息</td></tr> <tr><td>DEPLOYMENT_ID_</td> <td>部署ID</td> <td>nvarchar(255)</td> <td></td> <td>√</td> <td>部署ID</td></tr> <tr><td>EDITOR_SOURCE_VALUE_ID_</td> <td></td> <td>datetime</td> <td></td> <td>√</td> <td></td></tr> <tr><td>EDITOR_SOURCE_EXTRA_VALUE_ID_</td> <td></td> <td>datetime</td> <td></td> <td>√</td> <td></td></tr></tbody></table> <p>我们可以通过 <code>META_INFO</code> 字段，额外拓展了 <code>icon</code> 图标、<code>description</code> 描述、<code>formType</code>、<code>formId</code>、<code>formCustomCreatePath</code>、<code>formCustomViewPath</code> 表单等信息。如下图所示：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本不区分 yudao-module-bpm-api 和 yudao-module-bpm-biz 子模块，代码直接合并到 yudao-module-bpm 模块的 src 目录下，更适合单体项目</p></div> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/META_INFO.png" alt="模型的拓展字段"></p> <h3 id="_1-2-流程设计器"><a href="#_1-2-%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8" class="header-anchor">#</a> 1.2 流程设计器</h3> <p>① BPMN 流程设计器，由项目的 <a href="https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/components/bpmnProcessDesigner/package/designer/ProcessDesigner.vue" target="_blank" rel="noopener noreferrer">ProcessDesigner.vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8.png" alt="流程设计器"></p> <p>它是基于 <a href="https://github.com/miyuesc/bpmn-process-designer" target="_blank" rel="noopener noreferrer">https://github.com/miyuesc/bpmn-process-designer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 拓展，底层是 <a href="https://github.com/bpmn-io" target="_blank" rel="noopener noreferrer">bpmn-js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="custom-block tip"><p class="custom-block-title">补充说明：</p> <p><code>bpmn-process-designer</code> 提供 Vue2 + ElementUI、Vue3 + NaiveUI 两个版本，而我们是 Vue3 + ElementPlus，是通过 Vue2 + ElementUI 迁移适配实现。</p></div> <p>② BPMN 预览，支持高亮，由 <a href="https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/components/bpmnProcessDesigner/package/designer/ProcessViewer.vue" target="_blank" rel="noopener noreferrer">ProcessViewer.vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%B5%81%E7%A8%8B%E9%A2%84%E8%A7%88.png" alt="流程预览"></p> <p>它是直接基于 <a href="https://github.com/bpmn-io" target="_blank" rel="noopener noreferrer">bpmn-js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 拓展，没有基于 <code>bpmn-process-designer</code>。</p> <hr> <p>下面，我们将详细讲解 BPMN 流程设计器的各个配置项：任务（表单）、任务（审批人）、多实例（会签配置）、执行监听器、任务监听器等等。</p> <h3 id="_1-3-任务-表单"><a href="#_1-3-%E4%BB%BB%E5%8A%A1-%E8%A1%A8%E5%8D%95" class="header-anchor">#</a> 1.3 任务（表单）</h3> <h4 id="_1-3-1-表单配置"><a href="#_1-3-1-%E8%A1%A8%E5%8D%95%E9%85%8D%E7%BD%AE" class="header-anchor">#</a> 1.3.1 表单配置</h4> <p>每个任务节点，有个 [表单] 配置项，用于配置任务审批时，补充填写表单信息。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8%E7%9A%84%E8%A1%A8%E5%8D%95%E9%85%8D%E7%BD%AE.png" alt="流程设计器的表单配置.png"></p> <div class="custom-block tip"><p class="custom-block-title">拓展知识：</p> <p>① 问题：配置的表单，最终是怎么存储的？</p> <p>回答：在 BPMN 的 UserTask 节点上，有个 <code>formKey</code> 属性，用于存储表单的 key，这里我们就存了【流程表单】的编号。</p> <p>② 问题：为什么只支持【流程表单】，不支持【业务表单】呢？</p> <p>回答：【业务表单】暂时没想到比较优雅的二次修改方案，因为它属于业务系统，无法在审批通过时，一起进行提交。</p> <p>③ 问题：表单设计器，怎么使用远程数据？</p> <p>回答：参见 <a href="https://docs.qq.com/doc/DZlNIVkZSTlVJVEd2" target="_blank" rel="noopener noreferrer">https://docs.qq.com/doc/DZlNIVkZSTlVJVEd2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档。</p></div> <h4 id="_1-3-2-表单效果"><a href="#_1-3-2-%E8%A1%A8%E5%8D%95%E6%95%88%E6%9E%9C" class="header-anchor">#</a> 1.3.2 表单效果</h4> <p>在审批任务通过时，需要额外填写表单信息，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8%E7%9A%84%E8%A1%A8%E5%8D%95%E6%95%88%E6%9E%9C.png" alt="流程设计器的表单效果.png"></p> <p>填写的表单数据，会存储到 Flowable 任务的 <code>variables</code> 中，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8%E7%9A%84%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE.png" alt="流程设计器的表单数据"></p> <h3 id="_1-4-任务-审批人"><a href="#_1-4-%E4%BB%BB%E5%8A%A1-%E5%AE%A1%E6%89%B9%E4%BA%BA" class="header-anchor">#</a> 1.4 任务（审批人）</h3> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E9%80%89%E6%8B%A9%E5%AE%A1%E6%89%B9%E4%BA%BA/%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8%E7%9A%84%E5%AE%A1%E6%89%B9%E4%BA%BA%E9%85%8D%E7%BD%AE.png" alt="流程设计器的审批人配置.png"></p> <p>详细见 <a href="/bpm/assignee/">《选择审批人、发起人自选》</a> 文档。</p> <h3 id="_1-5-多实例-会签配置"><a href="#_1-5-%E5%A4%9A%E5%AE%9E%E4%BE%8B-%E4%BC%9A%E7%AD%BE%E9%85%8D%E7%BD%AE" class="header-anchor">#</a> 1.5 多实例（会签配置）</h3> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8%E7%9A%84%E4%BC%9A%E7%AD%BE%E9%85%8D%E7%BD%AE.png" alt="流程设计器的会签配置"></p> <p>详细见 <a href="/bpm/multi-instance/">《会签、或签、依次审批》</a> 文档。</p> <h3 id="_1-6-执行监听器"><a href="#_1-6-%E6%89%A7%E8%A1%8C%E7%9B%91%E5%90%AC%E5%99%A8" class="header-anchor">#</a> 1.6 执行监听器</h3> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/BpmTaskAssignStartUserExpressionConfig.png" alt="BpmTaskAssignStartUserExpressionConfig"></p> <p>详细见 <a href="/bpm/listener/">《执行监听器、任务监听器》</a> 文档。</p> <h3 id="_1-7-任务监听器"><a href="#_1-7-%E4%BB%BB%E5%8A%A1%E7%9B%91%E5%90%AC%E5%99%A8" class="header-anchor">#</a> 1.7 任务监听器</h3> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%9B%91%E5%90%AC%E5%99%A8/DemoDelegateClassTaskListenerConfig.png" alt="配置监听器"></p> <p>详细见 <a href="/bpm/listener/">《执行监听器、任务监听器》</a> 文档。</p> <h2 id="_2-流程定义"><a href="#_2-%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89" class="header-anchor">#</a> 2. 流程定义</h2> <p>流程模型在部署后，会创建一个新版本的流程定义，并挂起老版本的流程定义。最终，我们点击某个流程模型的「流程定义」按钮，可以看到它对应的流程定义，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89.png" alt="流程定义"></p> <ul><li>后端，由 BpmProcessDefinitionController 提供接口</li> <li>前端，由 <a href="https://github.com/yudaocode/yudao-ui-admin-vue3" target="_blank" rel="noopener noreferrer"><code>/views/bpm/definition/index.vue</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现界面</li></ul> <h3 id="_2-1-表结构"><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 2.1 表结构</h3> <p>① 流程定义表，由 Flowable 提供的 <code>ACT_RE_PROCDEF</code> 表实现，如下所示：</p> <table><thead><tr><th>字段</th> <th>类型</th> <th>主键</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>ID_</td> <td>NVARCHAR2(64)</td> <td>Y</td> <td>主键</td> <td></td></tr> <tr><td>REV_</td> <td>INTEGER</td> <td>N</td> <td>数据版本号</td> <td></td></tr> <tr><td>CATEGORY_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>流程定义分类</td> <td>读取 xml 文件中程的 <code>targetNamespace</code> 值</td></tr> <tr><td>NAME_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>流程定义的名称</td> <td>读取流程文件中 <code>process</code>元素的 <code>name</code> 属性</td></tr> <tr><td>KEY_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>流程定义key</td> <td>读取流程文件中 <code>process</code> 元素的 id 属性</td></tr> <tr><td>VERSION_</td> <td>INTEGER</td> <td>N</td> <td>版本</td> <td></td></tr> <tr><td>DEPLOYMENT_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>部署ID</td> <td>流程定义对应的部署数据 ID</td></tr> <tr><td>RESOURCE_NAME_</td> <td>NVARCHAR2(2000)</td> <td>N</td> <td>bpmn文件名称</td> <td>一般为流程文件的相对路径</td></tr> <tr><td>DGRM_RESOURCE_NAME_</td> <td>VARCHAR2(4000)</td> <td>N</td> <td>流程定义对应的流程图资源名称</td> <td></td></tr> <tr><td>DESCRIPTION_</td> <td>NVARCHAR2(2000)</td> <td>N</td> <td>说明</td> <td></td></tr> <tr><td>HAS_START_FORM_KEY_</td> <td>NUMBER(1)</td> <td>N</td> <td>是否存在开始节点formKey</td> <td><code>start</code> 节点是否存在 <code>formKey</code>：0-否，1-是</td></tr> <tr><td>HAS_GRAPHICAL_NOTATION_</td> <td>NUMBER(1)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>SUSPENSION_STATE_</td> <td>INTEGER</td> <td>N</td> <td>流程定义状态</td> <td>1-激活、2中止</td></tr> <tr><td>TENANT_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>ENGINE_VERSION_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td></td> <td>引擎版本</td></tr></tbody></table> <p>② 由于 <code>ACT_RE_PROCDEF</code> 表没有类似 <code>ACT_RE_MODEL</code> 有 <code>META_INFO_</code> 字段，所以我们额外创建了一个 BPM 流程定义的信息表，用于存储流程定义的额外信息。如下所示：</p> <blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>bpm_process_definition_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>process_definition_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'流程定义的编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>model_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'流程模型的编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>icon<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'图标'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>description<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'描述'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>form_type<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'表单类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>form_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'表单编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>form_conf<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'表单的配置'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>form_fields<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'表单项的数组'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>form_custom_create_path<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'自定义表单的提交路径'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>form_custom_view_path<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'自定义表单的查看路径'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">246</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'BPM 流程定义的信息表'</span><span class="token punctuation">;</span>
</code></pre></div><p>本质上，就是把 <code>ACT_RE_MODEL</code> 的 <code>META_INFO_</code> 字段存储到 <code>bpm_process_definition_info</code> 表中。</p> <p>因此，最终每次流程模型在部署时，会往 Flowable 插入一条 <code>ACT_RE_PROCDEF</code> 记录，也会往 <code>bpm_process_definition_info</code> 表中插入一条记录。</p> <h3 id="_2-2-流程定义列表-可发起流程"><a href="#_2-2-%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89%E5%88%97%E8%A1%A8-%E5%8F%AF%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 2.2 流程定义列表（可发起流程）</h3> <p>注意！一个流程模型，有且仅有一个【激活】状态的流程定义。最终，用户发起流程时，选择的是【激活】状态的流程定义。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/BPMN%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8/%E6%BF%80%E6%B4%BB%E7%9A%84%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89.png" alt="激活的流程定义"></p></div></div>
    </div>
</body>
</html>