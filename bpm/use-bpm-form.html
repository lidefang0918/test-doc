<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>审批接入（流程表单） | ruoyi-vue-pro 开发指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .source-url {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        .content-wrapper {
            line-height: 1.8;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            background: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>审批接入（流程表单） | ruoyi-vue-pro 开发指南</h1>
        <div class="source-url">原始链接: <a href="https://doc.iocoder.cn/bpm/use-bpm-form/">https://doc.iocoder.cn/bpm/use-bpm-form/</a></div>
    </div>
    <div class="content-wrapper">
        <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">审批接入（流程表单）<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">相关视频：</p> <ul><li><a href="https://t.zsxq.com/04nun2RRz" target="_blank" rel="noopener noreferrer">02、如何实现动态的流程表单？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/04uneeaUb" target="_blank" rel="noopener noreferrer">03、如何实现流程表单的保存？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/04jiMrjAm" target="_blank" rel="noopener noreferrer">04、如何实现流程表单的展示？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>项目基于 Flowable 实现了工作流的功能，提供两种方式接入：</p> <ul><li>① 【流程表单】：在线配置动态表单，无需建表与开发</li> <li>② 【业务表单】：业务需建立独立的数据库表，并开发对应的表单、详情界面</li></ul> <p>我们以“请假流程”为例子，讲解两种接入方式的差异，整个过程包括：</p> <ol><li>定义流程：【管理员】新建流程、设计流程模型、并设置用户任务的审批人，最终发布流程</li> <li>发起流程：【员工】选择流程，并发起流程实例</li> <li>审批流程：【审批人】接收到流程任务，审批结果为通过或不通过</li></ol> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E7%A4%BA%E4%BE%8B%E6%B5%81%E7%A8%8B.png" alt="示例流程"></p> <p>本文，我们讲解的是「业务接入（流程表单）」的流程，复杂业务接入的流程请查看<a href="/bpm/use-business-form">业务接入（业务表单）</a>。</p> <h2 id="_1-业务接入-流程表单"><a href="#_1-%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5-%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95" class="header-anchor">#</a> 1. 业务接入（流程表单）</h2> <h3 id="_1-1-第一步-定义流程"><a href="#_1-1-%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%AE%9A%E4%B9%89%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 1.1 第一步：定义流程</h3> <p>登录账号 admin、密码 admin123 的用户，扮演【管理员】的角色，进行流程的定义。</p> <h4 id="_1-1-1-新建流程"><a href="#_1-1-1-%E6%96%B0%E5%BB%BA%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 1.1.1 新建流程</h4> <p>访问 [工作流程 -&gt; 流程管理 -&gt; 流程模型] 菜单，点击「新建流程」按钮，填写流程标识、流程名称。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%96%B0%E5%BB%BA%E6%B5%81%E7%A8%8B.png" alt="新建流程"></p> <ul><li>流程标识：对应 BPMN 流程文件 XML 的 <code>id</code> 属性，不能重复，新建后不可修改。</li> <li>流程名称：对应 BPMN 流程文件 XML 的 <code>name</code> 属性。</li></ul> <div class="language-XML extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 这是一个 BPMN XML 的示例，主要看 id 和 name 属性 --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">bpmn2:</span>definitions</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>bpmn2</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.omg.org/spec/BPMN/20100524/MODEL<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>bpmndi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.omg.org/spec/BPMN/20100524/DI<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>diagram_Process_1647305370393<span class="token punctuation">"</span></span> <span class="token attr-name">targetNamespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://activiti.org/bpmn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">bpmn2:</span>process</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>common-form<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>通用表单流程<span class="token punctuation">"</span></span> <span class="token attr-name">isExecutable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">bpmndi:</span>BPMNDiagram</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BPMNDiagram_1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">bpmndi:</span>BPMNPlane</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>common-form_di<span class="token punctuation">"</span></span> <span class="token attr-name">bpmnElement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>common-form<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">bpmndi:</span>BPMNDiagram</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">bpmn2:</span>definitions</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_1-1-2-新建表单"><a href="#_1-1-2-%E6%96%B0%E5%BB%BA%E8%A1%A8%E5%8D%95" class="header-anchor">#</a> 1.1.2 新建表单</h4> <p>① 访问 [工作流程 -&gt; 流程管理 -&gt; 流程表单] 菜单，点击「新增」按钮，新增一个名字为 <code>leave-form</code> 的表单。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%96%B0%E5%BB%BA%E8%A1%A8%E5%8D%95-%E8%AE%BE%E8%AE%A1.png" alt="新建表单 - 设计"></p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%96%B0%E5%BB%BA%E8%A1%A8%E5%8D%95-%E4%BF%9D%E5%AD%98.png" alt="新建表单 - 保存"></p> <div class="custom-block tip"><p class="custom-block-title">友情提示：如果感觉有点麻烦，随便设计下，保存就 OK 了。</p></div> <p>② 回到 [工作流程 -&gt; 流程管理 -&gt; 流程模型] 菜单，点击「修改流程」按钮，配置表单类型为流程表单，选择名字为 <code>leave-form</code> 的流程表单。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E4%BF%AE%E6%94%B9%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95.png" alt="修改流程表单"></p> <h4 id="_1-1-3-设计流程"><a href="#_1-1-3-%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 1.1.3 设计流程</h4> <p>① 点击「设计流程」按钮，在线设计请假流程模型，包含两个用户任务：领导审批、HR 审批。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="设计流程"></p> <p>② 点击图中的“部门领导审批”，规则类型为“流程表达式”，流程表达式为 <code>${bpmTaskAssignLeaderExpression.calculateUsers(execution, 1)}</code>。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AE%BE%E7%BD%AE%E5%AE%A1%E6%89%B9%E4%BA%BA-%E9%83%A8%E9%97%A8%E9%A2%86%E5%AF%BC%E5%AE%A1%E6%89%B9.png" alt="设置审批人 - 部门领导审批"></p> <div class="custom-block tip"><p class="custom-block-title">友情提示：该流程表达式的作用是，流程发起人的一级领导。</p> <p>为什么呢？这块我们在 <a href="/bpm/expression/">《流程表达式》</a> 详细讲解。</p></div> <p>点击图中的“HR 审批”，规则类型为“岗位”，指定岗位为“人力资源”。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AE%BE%E7%BD%AE%E5%AE%A1%E6%89%B9%E4%BA%BA-HR%E5%AE%A1%E6%89%B9.png" alt="设置审批人 - HR 审批"></p> <p>之后，点击右上角的「保存模型」按钮，完成流程模型的设计。</p> <p>③ 点击「发布流程」按钮，把定义的流程模型部署出去。部署成功后，就可以发起该流程了。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%8F%91%E5%B8%83%E6%B5%81%E7%A8%8B.png" alt="发布流程"></p> <div class="custom-block tip"><p class="custom-block-title">修改流程后，需要重新发布流程吗？</p> <p>需要，<strong>必须重新发布</strong>才能生效。每次流程发布后，会生成一个新的流程定义，版本号从 v1 开始递增。</p> <p>发布成功后，会部署新版本的流程定义，旧版本的流程定义将被挂起。当然，已经发起的流程不会受到影响，还是走老的流程定义。</p></div> <h3 id="_2-第二步-发起流程"><a href="#_2-%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 2. 第二步：发起流程</h3> <p>登录账号 admin、密码 admin123 的用户，扮演【员工】的角色，进行流程的发起。</p> <h4 id="_2-1-发起流程"><a href="#_2-1-%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 2.1 发起流程</h4> <p>① 访问 [工作流程 -&gt; 审批中心 -&gt; 发起流程] 菜单，可以看到可以选择的流程定义的列表。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B.png" alt="发起流程"></p> <p>② 选择名字为“通用表单”的流程定义，发起请假流程。填写请假表单信息如下：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%A1%AB%E5%86%99%E6%B5%81%E7%A8%8B%E4%BF%A1%E6%81%AF.png" alt="填写流程信息"></p> <p>③ 点击提交成功后，可在 [工作流程 -&gt; 审批中心 -&gt; 我的流程]中，可看到该流程的状态、结果。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%88%91%E7%9A%84%E6%B5%81%E7%A8%8B.png" alt="我的流程"></p> <h4 id="_2-2-查看流程"><a href="#_2-2-%E6%9F%A5%E7%9C%8B%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 2.2 查看流程</h4> <p>点击「详情」按钮，可以查看申请的表单信息、审批记录、流程跟踪图。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%B5%81%E7%A8%8B%E8%AF%A6%E6%83%851.png" alt="流程详情 1"></p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%B5%81%E7%A8%8B%E8%AF%A6%E6%83%852.png" alt="流程详情 2"></p> <h3 id="_3-第三步-审批流程"><a href="#_3-%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%AE%A1%E6%89%B9%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 3. 第三步：审批流程</h3> <h4 id="_3-1-部门领导审批"><a href="#_3-1-%E9%83%A8%E9%97%A8%E9%A2%86%E5%AF%BC%E5%AE%A1%E6%89%B9" class="header-anchor">#</a> 3.1 部门领导审批</h4> <p>登录账号 test、密码 test123 的用户，扮演【审批人】的角色，进行请假流程的【领导审批】任务。</p> <p>① 访问 [工作流程 -&gt; 审批中心 -&gt; 待办任务] 菜单，可以查询到需要审批的任务。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%BE%85%E5%8A%9E%E4%BB%BB%E5%8A%A1.png" alt="待办任务"></p> <p>② 点击「办理」按钮，填写审批建议，并点击「通过」按钮，这样任务的审批就完成了。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E9%83%A8%E9%97%A8%E9%A2%86%E5%AF%BC%E5%AE%A1%E6%89%B9.png" alt="部门领导审批"></p> <p>③ 访问 [工作流程 -&gt; 审批中心 -&gt; 已办任务] 菜单，可以查询到已经审批的任务。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%B7%B2%E5%8A%9E%E4%BB%BB%E5%8A%A1.png" alt="已办任务"></p> <hr> <p>此时，使用【员工】的角色，访问 [工作流程 -&gt; 审批中心 -&gt; 我的流程] 菜单，可以看到流程流转到了【HR 审批】任务。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E9%83%A8%E9%97%A8%E9%A2%86%E5%AF%BC%E5%AE%A1%E6%89%B9%E5%90%8E%E6%88%91%E7%9A%84%E6%B5%81%E7%A8%8B.png" alt="部门领导审批后我的流程"></p> <h4 id="_3-2-hr-审批"><a href="#_3-2-hr-%E5%AE%A1%E6%89%B9" class="header-anchor">#</a> 3.2 HR 审批</h4> <p>登录账号 hrmgr、密码 hr123 的用户，扮演【审批人】的角色，进行请假流程的【HR 审批】任务。</p> <p>① 访问 [工作流程 -&gt; 审批中心 -&gt; 待办任务] 菜单，点击「审批」按钮，填写审批建议，并点击「通过」按钮。</p> <hr> <p>此时，使用【员工】的角色，访问 [工作流程 -&gt; 审批中心 -&gt; 我的流程] 菜单，可以看到流程处理结束，最终审批通过。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AF%B7%E5%81%87%E6%B5%81%E7%A8%8B%E6%9C%80%E7%BB%88%E7%8A%B6%E6%80%81.png" alt="请假流程最终状态"></p> <h2 id="_2-菜单【流程表单】"><a href="#_2-%E8%8F%9C%E5%8D%95%E3%80%90%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95%E3%80%91" class="header-anchor">#</a> 2. 菜单【流程表单】</h2> <p>本小节，我们单独讲解的是菜单 [工作流程 -&gt; 流程管理 -&gt; 流程表单] 的功能。</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95.png" alt="流程表单"></p> <p>该菜单主要用于流程表单的配置，不包括最终表单填写后的存储，由 BpmFormController 提供接口。</p> <h3 id="_2-1-表结构"><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 2.1 表结构</h3> <blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>bpm_form<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'表单名'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'开启状态'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>conf<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'表单的配置'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>fields<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'表单项的数组'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>remark<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'备注'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">28</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'BPM 表单定义表'</span><span class="token punctuation">;</span>
</code></pre></div><p>关键就 2 个字段：</p> <p>① <code>conf</code>：表单的配置，是一个 JSON 字符串，包含表单的基本配置、按钮等。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"form"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"labelPosition"</span><span class="token operator">:</span> <span class="token string">"right"</span><span class="token punctuation">,</span>
        <span class="token property">"size"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"labelWidth"</span><span class="token operator">:</span> <span class="token string">"125px"</span><span class="token punctuation">,</span>
        <span class="token property">"hideRequiredAsterisk"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"showMessage"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"inlineMessage"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"submitBtn"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"show"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"innerText"</span><span class="token operator">:</span> <span class="token string">"提交"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"resetBtn"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"show"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"innerText"</span><span class="token operator">:</span> <span class="token string">"重置"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应表单设计器的【表单配置】部分。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%A1%A8%E5%8D%95%E8%AE%BE%E8%AE%A1%E5%99%A8%E7%9A%84%E8%A1%A8%E5%8D%95%E9%85%8D%E7%BD%AE.png" alt="表单配置"></p> <p>② <code>fields</code>：表单项的数组，是一个 JSON 字符串，包含表单的所有字段。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token string">"{\"type\":\"datePicker\",\"field\":\"startTime\",\"title\":\"开始时间\",\"info\":\"\",\"$required\":true,\"_fc_drag_tag\":\"datePicker\",\"hidden\":false,\"display\":true}"</span><span class="token punctuation">,</span><span class="token string">"{\"type\":\"datePicker\",\"field\":\"Fm9i1onr8v6n68\",\"title\":\"结束时间\",\"info\":\"\",\"$required\":true,\"_fc_drag_tag\":\"datePicker\",\"hidden\":false,\"display\":true}"</span><span class="token punctuation">,</span><span class="token string">"{\"type\":\"select\",\"field\":\"type\",\"title\":\"请假类型\",\"info\":\"\",\"effect\":{\"fetch\":\"\"},\"$required\":false,\"options\":[{\"label\":\"事假\",\"value\":1},{\"label\":\"年假\",\"value\":2}],\"_fc_drag_tag\":\"select\",\"hidden\":false,\"display\":true}"</span><span class="token punctuation">,</span><span class="token string">"{\"type\":\"input\",\"field\":\"reason\",\"title\":\"请假原因\",\"info\":\"\",\"$required\":false,\"props\":{\"rows\":0,\"type\":\"textarea\"},\"_fc_drag_tag\":\"input\",\"hidden\":false,\"display\":true}"</span><span class="token punctuation">]</span>
</code></pre></div><p>对应表单设计器的【组件配置】部分。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%A1%A8%E5%8D%95%E8%AE%BE%E8%AE%A1%E5%99%A8%E7%9A%84%E7%BB%84%E4%BB%B6%E9%85%8D%E7%BD%AE.png" alt="组件配置"></p> <h3 id="_2-2-前端组件"><a href="#_2-2-%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6" class="header-anchor">#</a> 2.2 前端组件</h3> <p>基于 <a href="https://github.com/xaboy/form-create" target="_blank" rel="noopener noreferrer">https://github.com/xaboy/form-create<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现，支持 element-plus、ant-design-vue、naive-ui、arco-design、tdesign 等前端组件，还是非常不错的！</p> <p>中文文档：<a href="https://www.form-create.com/v3/guide/" target="_blank" rel="noopener noreferrer">https://www.form-create.com/v3/guide/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_2-2-1-表单设计器"><a href="#_2-2-1-%E8%A1%A8%E5%8D%95%E8%AE%BE%E8%AE%A1%E5%99%A8" class="header-anchor">#</a> 2.2.1 表单设计器</h4> <p>上文看到的“表单设计器”，在 <a href="https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/views/bpm/form/editor/index.vue" target="_blank" rel="noopener noreferrer"><code>bpm/form/editor/index.vue</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现，使用 <a href="https://github.com/xaboy/form-create-designer" target="_blank" rel="noopener noreferrer">form-create-designer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现。</p> <h4 id="_2-2-2-表单预览"><a href="#_2-2-2-%E8%A1%A8%E5%8D%95%E9%A2%84%E8%A7%88" class="header-anchor">#</a> 2.2.2 表单预览</h4> <p>点击「详情」按钮，可进行表单的预览，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%A1%A8%E5%8D%95%E9%A2%84%E8%A7%88.png" alt="表单预览"></p> <p>实现的逻辑，就是读取后端 <code>bpm_form</code> 表的 <code>conf</code> 和 <code>fields</code> 字段，然后使用 <code>form-create</code> 渲染。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%A1%A8%E5%8D%95%E9%A2%84%E8%A7%88%E7%9A%84%E4%BB%A3%E7%A0%81.png" alt="表单预览的代码"></p> <h4 id="_2-2-3-表单填写"><a href="#_2-2-3-%E8%A1%A8%E5%8D%95%E5%A1%AB%E5%86%99" class="header-anchor">#</a> 2.2.3 表单填写</h4> <p>在 [工作流程 -&gt; 审批中心 -&gt; 发起流程] 菜单，点击「填写表单」按钮，可以填写表单。它也是基于 <code>form-create</code> 实现的，只是额外实现了 <code>@submit</code> 事件，用于提交表单。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%A1%A8%E5%8D%95%E5%A1%AB%E5%86%99%E7%9A%84%E4%BB%A3%E7%A0%81.png" alt="表单填写的代码"></p> <p>相比表单预览，它通过 <code>v-model</code> 获取表单的值，可通过 <code>v-model:api</code> 对应的 <code>fApi</code> 对象，进行表单的校验、重置等操作。</p> <div class="custom-block tip"><p class="custom-block-title">友情提问：使用流程表单时，提交的表单数据是怎么存储的？</p> <p>存储到 Flowable 的 ProcessInstance 的 <code>variables</code> 中。如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.png" alt="流程表单数据存储"></p></div> <h2 id="_666-常见问题"><a href="#_666-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" class="header-anchor">#</a> 666. 常见问题？</h2> <p>① 流程中表单里面的附件上传，除了 pdf 这几种格式，可以支持别的格式的附件吗？</p> <p>回答：<a href="https://t.zsxq.com/bKzyd" target="_blank" rel="noopener noreferrer">https://t.zsxq.com/bKzyd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div>
    </div>
</body>
</html>