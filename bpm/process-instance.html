<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>流程发起、取消、重新发起 | ruoyi-vue-pro 开发指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .source-url {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        .content-wrapper {
            line-height: 1.8;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            background: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>流程发起、取消、重新发起 | ruoyi-vue-pro 开发指南</h1>
        <div class="source-url">原始链接: <a href="https://doc.iocoder.cn/bpm/process-instance/">https://doc.iocoder.cn/bpm/process-instance/</a></div>
    </div>
    <div class="content-wrapper">
        <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">流程发起、取消、重新发起<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">相关视频：</p> <ul><li><a href="https://t.zsxq.com/04jyvNfqj" target="_blank" rel="noopener noreferrer">11、如何实现流程的发起？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/046UFqRzz" target="_blank" rel="noopener noreferrer">12、如何实现我的流程列表？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://t.zsxq.com/04aM72rzv" target="_blank" rel="noopener noreferrer">13、如何实现流程的取消？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>本文的内容比较简单，主要围绕 [审批中心] 菜单下的 [我的流程]、[发起流程] 子菜单，讲解流程的发起、取消、重新发起的操作流程。</p> <h2 id="_1-发起流程"><a href="#_1-%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 1. 发起流程</h2> <p>发起流程，对应 [审批中心 -&gt; 发起流程] 菜单，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B.png" alt="发起流程"></p> <h3 id="_1-1-表结构"><a href="#_1-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 1.1 表结构</h3> <p>① 流程实例表，由 Flowable 提供的 <code>ACT_RU_EXECUTION</code> 表实现，如下所示：</p> <table><thead><tr><th>字段</th> <th>类型</th> <th>主键</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>ID_</td> <td>NVARCHAR2(64)</td> <td>Y</td> <td>主键</td> <td></td></tr> <tr><td>REV_</td> <td>INTEGER</td> <td>N</td> <td>数据版本</td> <td></td></tr> <tr><td>PROC_INST_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>流程实例 ID</td> <td></td></tr> <tr><td>BUSINESS_KEY_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>业务主键 ID</td> <td></td></tr> <tr><td>PARENT_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>父执行流的 ID</td> <td></td></tr> <tr><td>PROC_DEF_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>流程定义的数据 ID</td> <td></td></tr> <tr><td>SUPER_EXEC_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>ROOT_PROC_INST_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>ACT_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>节点实例 ID</td> <td></td></tr> <tr><td>IS_ACTIVE_</td> <td>NUMBER(1)</td> <td>N</td> <td>是否存活</td> <td></td></tr> <tr><td>IS_CONCURRENT_</td> <td>NUMBER(1)</td> <td>N</td> <td>执行流是否正在并行</td> <td></td></tr> <tr><td>IS_SCOPE_</td> <td>NUMBER(1)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>IS_EVENT_SCOPE_</td> <td>NUMBER(1)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>IS_MI_ROOT_</td> <td>NUMBER(1)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>SUSPENSION_STATE_</td> <td>INTEGER</td> <td>N</td> <td>流程终端状态</td> <td></td></tr> <tr><td>CACHED_ENT_STATE_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>TENANT_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>NAME_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>START_TIME_</td> <td>TIMESTAMP(6)</td> <td>N</td> <td>开始时间</td> <td></td></tr> <tr><td>START_USER_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>LOCK_TIME_</td> <td>TIMESTAMP(6)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>IS_COUNT_ENABLED_</td> <td>NUMBER(1)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>EVT_SUBSCR_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>TASK_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>JOB_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>TIMER_JOB_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>SUSP_JOB_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>DEADLETTER_JOB_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>VAR_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr> <tr><td>ID_LINK_COUNT_</td> <td>INTEGER</td> <td>N</td> <td></td> <td></td></tr></tbody></table> <p>② 流程参数表，由 Flowable 提供的 <code>ACT_RU_VARIABLE</code> 表实现，如下所示：</p> <table><thead><tr><th>字段</th> <th>类型</th> <th>主键</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>ID_</td> <td>NVARCHAR2(64)</td> <td>Y</td> <td>主键</td> <td></td></tr> <tr><td>REV_</td> <td>INTEGER</td> <td>N</td> <td>数据版本</td> <td></td></tr> <tr><td>TYPE_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>参数类型</td> <td>可以是基本的类型，也可以用户自行扩展</td></tr> <tr><td>NAME_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>参数名称</td> <td></td></tr> <tr><td>EXECUTION_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>参数执行 ID</td> <td></td></tr> <tr><td>PROC_INST_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>流程实例 ID</td> <td></td></tr> <tr><td>TASK_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>任务 ID</td> <td></td></tr> <tr><td>BYTEARRAY_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>资源 ID</td> <td></td></tr> <tr><td>DOUBLE_</td> <td>NUMBER(*,10)</td> <td>N</td> <td>参数为 double，则保存在该字段中</td> <td></td></tr> <tr><td>LONG_</td> <td>NUMBER(19)</td> <td>N</td> <td>参数为 long，则保存在该字段中</td> <td></td></tr> <tr><td>TEXT_</td> <td>NVARCHAR2(2000)</td> <td>N</td> <td>用户保存文本类型的参数值</td> <td></td></tr> <tr><td>TEXT2_</td> <td>NVARCHAR2(2000)</td> <td>N</td> <td>用户保存文本类型的参数值</td> <td></td></tr></tbody></table> <p>在 Flowable 中，如果想给 ProcessInstance 增加拓展字段，无法通过 <code>ACT_RU_EXECUTION</code> 实现，而是通过 <code>ACT_RU_VARIABLE</code> 表实现。</p> <p>该表是一种 Key-Value 的形式，可以存储任意类型的数据。例如说，项目中给 ProcessInstance 增加了一个 <code>PROCESS_STATUS</code> 字段，表示流程状态，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/PROCESS_STATUS.png" alt="PROCESS_STATUS"></p> <h3 id="_1-2-流程状态"><a href="#_1-2-%E6%B5%81%E7%A8%8B%E7%8A%B6%E6%80%81" class="header-anchor">#</a> 1.2 流程状态</h3> <p>流程状态，由 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/src/main/java/cn/iocoder/yudao/module/bpm/enums/task/BpmProcessInstanceStatusEnum.java" target="_blank" rel="noopener noreferrer">BpmProcessInstanceStatusEnum<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 目前有 4 种，如下图所示：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本不区分 yudao-module-bpm-api 和 yudao-module-bpm-biz 子模块，代码直接合并到 yudao-module-bpm 模块的 src 目录下，更适合单体项目</p></div> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%B5%81%E7%A8%8B%E7%8A%B6%E6%80%81.png" alt="流程状态"></p> <h3 id="_1-3-具体实现"><a href="#_1-3-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0" class="header-anchor">#</a> 1.3 具体实现</h3> <ul><li>前端，对应 <code>/views/bpm/processInstance/create/index.vue</code> 实现界面</li> <li>后端，对应 BpmProcessInstanceController 的 <code>#createProcessInstance(...)</code> 提供接口</li></ul> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本不区分 yudao-module-bpm-api 和 yudao-module-bpm-biz 子模块，代码直接合并到 yudao-module-bpm 模块的 src 目录下，更适合单体项目</p></div> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B%E7%9A%84%E5%AE%9E%E7%8E%B0.png" alt="发起流程的实现"></p> <p>最核心的，就是调用 Flowable 的 <code>RuntimeService#createProcessInstanceBuilder().start()</code> 方法，创建流程实例。同时因为 Flowable 自身没有流程状态，所以需要我们自己维护任务状态。</p> <h2 id="_2-我的流程"><a href="#_2-%E6%88%91%E7%9A%84%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 2. 我的流程</h2> <p>我的流程，对应 [审批中心 -&gt; 我的流程] 菜单，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%88%91%E7%9A%84%E6%B5%81%E7%A8%8B.png" alt="我的流程"></p> <h3 id="_2-1-表结构"><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 2.1 表结构</h3> <p>① 历史流程实例表，由 Flowable 提供的 <code>ACT_HI_PROCINST</code> 表实现，如下所示：</p> <table><thead><tr><th>字段</th> <th>类型</th> <th>主键</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>ID_</td> <td>NVARCHAR2(64)</td> <td>Y</td> <td>主键</td> <td></td></tr> <tr><td>PROC_INST_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>流程实例 ID</td> <td></td></tr> <tr><td>BUSINESS_KEY_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>业务主键</td> <td></td></tr> <tr><td>PROC_DEF_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>属性 ID</td> <td></td></tr> <tr><td>START_TIME_</td> <td>TIMESTAMP(6)</td> <td>N</td> <td>开始时间</td> <td></td></tr> <tr><td>END_TIME_</td> <td>TIMESTAMP(6)</td> <td>N</td> <td>结束时间</td> <td></td></tr> <tr><td>DURATION_</td> <td>NUMBER(19)</td> <td>N</td> <td>耗时</td> <td></td></tr> <tr><td>START_USER_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>起始人</td> <td></td></tr> <tr><td>START_ACT_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>起始节点</td> <td></td></tr> <tr><td>END_ACT_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>结束节点</td> <td></td></tr> <tr><td>SUPER_PROCESS_INSTANCE_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>父流程实例 ID</td> <td></td></tr> <tr><td>DELETE_REASON_</td> <td>NVARCHAR2(2000)</td> <td>N</td> <td>删除原因</td> <td></td></tr> <tr><td>TENANT_ID_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>NAME_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>名称</td> <td></td></tr></tbody></table> <p>在 Flowable 中，如果 ProcessInstance 被完成（全部审批通过、不通过、取消等）时候，会从 <code>ACT_RU_EXECUTION</code> 表中删除，只能在 <code>ACT_HI_PROCINST</code> 表查询到。这是一种“冷热分离”的设计思想，因为进行的任务访问比较频繁，数据量越小，性能会越好。</p> <p>而 [我的流程] 需要查询进行中、已完成的流程，所以需要查询 <code>ACT_HI_PROCINST</code> 表，而不能使用 <code>ACT_RU_EXECUTION</code> 表。</p> <p>② 流程历史参数表，由 Flowable 提供的 <code>ACT_HI_VARINST</code> 表实现，如下所示：</p> <table><thead><tr><th>字段</th> <th>类型</th> <th>主键</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>ID_</td> <td>NVARCHAR2(64)</td> <td>Y</td> <td>主键</td> <td></td></tr> <tr><td>PROC_INST_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>流程实例 ID</td> <td></td></tr> <tr><td>EXECUTION_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>指定 ID</td> <td></td></tr> <tr><td>TASK_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>任务 ID</td> <td></td></tr> <tr><td>NAME_</td> <td>NVARCHAR2(255)</td> <td>N</td> <td>名称</td> <td></td></tr> <tr><td>VAR_TYPE_</td> <td>NVARCHAR2(100)</td> <td>N</td> <td>参数类型</td> <td></td></tr> <tr><td>REV_</td> <td>INTEGER</td> <td>N</td> <td>数据版本</td> <td></td></tr> <tr><td>BYTEARRAY_ID_</td> <td>NVARCHAR2(64)</td> <td>N</td> <td>字节表 ID</td> <td></td></tr> <tr><td>DOUBLE_</td> <td>NUMBER(*,10)</td> <td>N</td> <td>存储 double 类型数据</td> <td></td></tr> <tr><td>LONG_</td> <td>NUMBER(*,10)</td> <td>N</td> <td>存储 long 类型数据</td> <td></td></tr> <tr><td>TEXT_</td> <td>NVARCHAR2(2000)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>TEXT2_</td> <td>NVARCHAR2(2000)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>CREATE_TIME_</td> <td>TIMESTAMP(6)(2000)</td> <td>N</td> <td></td> <td></td></tr> <tr><td>LAST_UPDATED_TIME_</td> <td>TIMESTAMP(6)(2000)</td> <td>N</td> <td></td> <td></td></tr></tbody></table> <p>在 Flowable 中，如果 ProcessInstance 被完成（全部审批通过、不通过、取消等）时候，会从 <code>ACT_RU_VARIABLE</code> 表中删除，只能在 <code>ACT_HI_VARINST</code> 表查询到。这当然也是是一种“冷热分离”的设计思想~</p> <h3 id="_2-2-具体实现"><a href="#_2-2-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0" class="header-anchor">#</a> 2.2 具体实现</h3> <ul><li>前端，对应 <code>/views/bpm/processInstance/index.vue</code> 实现界面</li> <li>后端，对应 BpmProcessInstanceController 的 <code>#getProcessInstanceMyPage(...)</code> 提供接口</li></ul> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本不区分 yudao-module-bpm-api 和 yudao-module-bpm-biz 子模块，代码直接合并到 yudao-module-bpm 模块的 src 目录下，更适合单体项目</p></div> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%88%91%E7%9A%84%E6%B5%81%E7%A8%8B%E7%9A%84%E5%AE%9E%E7%8E%B0.png" alt="我的流程的实现"></p> <h3 id="_2-1-取消流程"><a href="#_2-1-%E5%8F%96%E6%B6%88%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 2.1 取消流程</h3> <p>可点击某个流程的「取消」按钮，进行流程的取消，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%96%E6%B6%88%E6%B5%81%E7%A8%8B.png" alt="取消流程"></p> <p>后端由 BpmProcessInstanceController 的 <code>#cancelProcessInstance(...)</code> 提供接口，如下图所示：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本不区分 yudao-module-bpm-api 和 yudao-module-bpm-biz 子模块，代码直接合并到 yudao-module-bpm 模块的 src 目录下，更适合单体项目</p></div> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%96%E6%B6%88%E6%B5%81%E7%A8%8B%E7%9A%84%E5%AE%9E%E7%8E%B0.png" alt="取消流程的实现"></p> <ul><li>最核心的，就是调用 Flowable 的 <code>RuntimeService#deleteProcessInstance(...)</code> 方法，取消流程实例。</li></ul> <p>可能你会有疑问，哪里将流程状态更新为 <code>CANCEL</code> 已取消呢？答案在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/src/main/java/cn/iocoder/yudao/module/bpm/framework/flowable/core/listener/BpmProcessInstanceEventListener.java" target="_blank" rel="noopener noreferrer">BpmProcessInstanceEventListener<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 监听器，它会监听到流程实例变更为取消，然后调用 BpmProcessInstanceController 的 <code>#updateProcessInstanceWhenCancel(...)</code> 方法，进行更新。如下图所示：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本不区分 yudao-module-bpm-api 和 yudao-module-bpm-biz 子模块，代码直接合并到 yudao-module-bpm 模块的 src 目录下，更适合单体项目</p></div> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B%E4%B8%BA%E5%B7%B2%E5%8F%96%E6%B6%88.png" alt="更新流程为已取消"></p> <h3 id="_2-2-重新发起流程"><a href="#_2-2-%E9%87%8D%E6%96%B0%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B" class="header-anchor">#</a> 2.2 重新发起流程</h3> <p>流程结束后，可点击它的「重新发起」按钮，进行流程的重新发起，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E9%87%8D%E6%96%B0%E5%8F%91%E8%B5%B7.png" alt="重新发起"></p> <p>它的效果是，跳转到 [发起流程] 页面，然后将之前的流程参数，填充到表单中，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E9%87%8D%E6%96%B0%E5%8F%91%E8%B5%B7%E9%A1%B5.png" alt="重新发起"></p> <p>因此，它最终调用的还是「1. 发起流程」小节的发起流程接口，再次（重新）发起一个流程。</p> <h2 id="_3-流程实例"><a href="#_3-%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B" class="header-anchor">#</a> 3. 流程实例</h2> <p>流程实例，展示系统中所有的流程，一般用于管理员查询，对应 [流程管理 -&gt; 流程实例] 菜单，如下图所示：</p> <p><img src="/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B.png" alt="流程实例"></p> <ul><li>后端，对应 BpmProcessInstanceController 的 <code>#getProcessInstanceManagerPage(...)</code> 提供接口</li> <li>前端，对应 <code>/views/bpm/processInstance/manager/index.vue</code> 实现界面</li></ul> <p>由于它查询的是所有流程，所以读取的是 <code>ACT_HI_PROCINST</code> 表，而不是 <code>ACT_RU_EXECUTION</code> 表。</p></div></div>
    </div>
</body>
</html>