<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>短信配置 | ruoyi-vue-pro 开发指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .source-url {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        .content-wrapper {
            line-height: 1.8;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            background: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>短信配置 | ruoyi-vue-pro 开发指南</h1>
        <div class="source-url">原始链接: <a href="https://doc.iocoder.cn/sms/">https://doc.iocoder.cn/sms/</a></div>
    </div>
    <div class="content-wrapper">
        <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">短信配置<!----></h1>  <div class="theme-vdoing-content content__default"><p>本章节，介绍项目的短信功能。该功能提供统一的短信 API 给其它模块，使它们可以快速接入短信功能，无需关心不同短信平台的具体对接。</p> <p>短信采用异步发送，基于 <a href="/message-queue/event">消息队列</a>，如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/01.png" alt="整体流程"></p> <p>该功能由 <code>yudao-module-system</code> 模块实现，其中：</p> <ul><li><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/service/sms/" target="_blank" rel="noopener noreferrer"><code>service/sms</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：短信【业务】，提供短信渠道、模板的配置，短信日志的查看，短信的发送等功能</li> <li><a href="https://github.com/YunaiV/ruoyi-vue-pro/tree/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/framework/sms" target="_blank" rel="noopener noreferrer"><code>frameowrk/sms</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：短信【组件】，封装阿里云、腾讯云、华为云、七牛云等短信平台的客户端。</li></ul> <h2 id="_1-表结构"><a href="#_1-%E8%A1%A8%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 1. 表结构</h2> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/02.png" alt="表结构"></p> <h2 id="_2-短信配置"><a href="#_2-%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE" class="header-anchor">#</a> 2. 短信配置</h2> <p>本小节，讲解如何配置短信功能，整个过程如下：</p> <ul><li>新建一个短信【渠道】，配置对应短信平台的账号</li> <li>新建一个短信【模版】，配置对应短信平台的模板</li> <li>测试该短信模板，查看对应的短信【日志】，确认是否发送成功</li></ul> <h3 id="_2-1-新建短信渠道"><a href="#_2-1-%E6%96%B0%E5%BB%BA%E7%9F%AD%E4%BF%A1%E6%B8%A0%E9%81%93" class="header-anchor">#</a> 2.1 新建短信渠道</h3> <p>① 点击 [系统管理 -&gt; 消息中心 -&gt; 短信管理 -&gt; 短信渠道] 菜单，查看短信渠道的列表。如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/03.png" alt="短信渠道的列表"></p> <p>② 点击 [新增] 按钮，选择渠道编码为【调试（钉钉）】，并填写信息如下图：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/04.png" alt="短信渠道的新增"></p> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">短信 API 的账号</span><span class="token punctuation">:</span> 696b5d8ead48071237e4aa5861ff08dbadb2b4ded1c688a7b7c9afc615579859
<span class="token key atrule">短信 API 的密钥</span><span class="token punctuation">:</span> SEC5c4e5ff888bc8a9923ae47f59e7ccd30af1f14d93c55b4e2c9cb094e35aeed67
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">疑问 1：为什么选择渠道编码为【调试（钉钉）】？</p> <p>该类型使用钉钉机器人来模拟短信发送，用于日常调试。</p> <ul><li>短信 API 的账号，对应机器人的 Webhook 的 <code>access_token</code> 参数</li> <li>短信 API 的密钥，对应机器人的安全设置的加签</li></ul> <p>上图使用的配置，是艿艿自己的钉钉机器人。正式使用时，必须参考 <a href="https://open.dingtalk.com/document/group/custom-robot-access" target="_blank" rel="noopener noreferrer">《钉钉开放平台 —— 自定义机器人接入 》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档，申请自己的专属机器人。</p></div> <div class="custom-block tip"><p class="custom-block-title">疑问 2：可以选择其它渠道编码吗？</p> <p>当然可以，这里主要考虑部分同学暂时没有申请短信平台，所以使用【调试（钉钉）】渠道编码。</p> <p>不同短信平台的配置，可见 <a href="#_6-%E7%9F%AD%E4%BF%A1%E5%B9%B3%E5%8F%B0%E9%99%84%E5%BD%95">「6. 短信平台附录」</a> 小节。</p></div> <h3 id="_2-2-新建短信模板"><a href="#_2-2-%E6%96%B0%E5%BB%BA%E7%9F%AD%E4%BF%A1%E6%A8%A1%E6%9D%BF" class="header-anchor">#</a> 2.2 新建短信模板</h3> <p>① 点击 [系统管理 -&gt; 消息中心 -&gt; 短信管理 -&gt; 短信模板] 菜单，查看短信模板的列表。如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/05.png" alt="短信模板的新增"></p> <p>② 点击 [新增] 按钮，选择刚创建的短信渠道，并填写信息如下图：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/06.png" alt="短信模板的新增"></p> <ul><li>短信渠道编号：发送该短信模板时，使用的短信渠道，即使用哪个短信平台进行发送</li> <li>模板编号：短信模板的唯一标识，使用短信 API 时，通过它标识使用的短信模板</li> <li>模板内容：短信模板的内容，使用 <code>{var}</code> 作为占位符，例如说 <code>{name}</code>、<code>{code}</code> 等</li> <li>短信 API 模板编号：短信平台的短信模板的编号，需要保证该模板在短信平台已经审核通过</li> <li>开启状态：短信模板被禁用时，该短信模板将不发送短信，只记录短信日志</li></ul> <div class="custom-block tip"><p class="custom-block-title">疑问：为什么设计短信模板的功能？</p> <p>在一些场景下，需要修改短信模板所使用的短信平台。例如说：短信平台出现故障，或者切换短信平台等等。</p> <p>此时，只需要修改短信模板的两个属性：短信渠道编号、短信 API 模板编号，无需重启应用。</p></div> <h3 id="_2-3-查看短信日志"><a href="#_2-3-%E6%9F%A5%E7%9C%8B%E7%9F%AD%E4%BF%A1%E6%97%A5%E5%BF%97" class="header-anchor">#</a> 2.3 查看短信日志</h3> <p>① 使用钉钉，扫码 <a href="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/07.jpg">图片</a> 加入机器人所在的【ruoyi-vue-pro 短信测试群】，查看测试短信的模拟发送。</p> <p>② 点击 [测试] 按钮，输入任一手机号，进行该短信模板的模拟发送。如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/08.png" alt="测试短信模板"></p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/09.png" alt="测试短信模板"></p> <div class="custom-block tip"><p class="custom-block-title">友情提示：如果使用的短信渠道是阿里云、腾讯云等正式的短信平台，则会发送到填写的手机号中。例如说：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/10.png" alt="接收示例"></p></div> <p>③ 点击 [系统管理 -&gt; 消息中心 -&gt; 短信管理 -&gt; 短信日志] 采单，可以查看到每条短信的发送状态、接收状态。如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/11.png" alt="短信日志"></p> <div class="custom-block tip"><p class="custom-block-title">常见问题：为什么日志的接受状态，一直处理“等待结果”？</p> <p>因为你没配置短信回调 URL，导致短信平台无法回调我们的系统，所以一直等待结果。具体怎么配置，可见 <a href="#_6-%E7%9F%AD%E4%BF%A1%E5%B9%B3%E5%8F%B0%E9%99%84%E5%BD%95">短信平台附录</a> 小节。</p></div> <h2 id="_3-短信发送"><a href="#_3-%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81" class="header-anchor">#</a> 3. 短信发送</h2> <h3 id="_3-1-smssendapi"><a href="#_3-1-smssendapi" class="header-anchor">#</a> 3.1 SmsSendApi</h3> <p>使用 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/api/sms/SmsSendApi.java" target="_blank" rel="noopener noreferrer">SmsSendApi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行短信的发送，支持多种用户类型。它的方法如下：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/21.png" alt="短信发送"></p> <h3 id="_3-2-实战案例"><a href="#_3-2-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B" class="header-anchor">#</a> 3.2 实战案例</h3> <p>以工作流申请通过时，发送短信为例子，讲解 SmsSendApi 的使用。</p> <p>① 引入 <code>yudao-module-system</code> 依赖，如下图所示：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本引入 `yudao-module-system` 依赖即可，因为 `yudao-module-system-api` 已经合并到 `yudao-module-system` 中。</p></div> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/22.png" alt=" 依赖"></p> <p>② 新建对应的短信模板，如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/23.png" alt="新建短信模板"></p> <p>③ 使用 Spring 注入 SmsSendApi Bean，调用对应的短信发送方法。如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/24.png" alt="调用 SmsSendApi 方法"></p> <h2 id="_4-验证码发送"><a href="#_4-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%91%E9%80%81" class="header-anchor">#</a> 4. 验证码发送</h2> <h3 id="_4-1-smscodeapi"><a href="#_4-1-smscodeapi" class="header-anchor">#</a> 4.1 SmsCodeApi</h3> <p>使用 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/api/sms/SmsCodeApi.java" target="_blank" rel="noopener noreferrer">SmsCodeApi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行【验证码】短信的发送，例如说：用户手机验证码登录、用户忘记密码等等。它的方法如下：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/21.png" alt="短信发送"></p> <p>验证码使用 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/sms/SmsCodeDO.java" target="_blank" rel="noopener noreferrer"><code>system_sms_code</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 表进行存储，默认每天最多发送 10 条，每分钟发送 1 条，有效期为 10 分钟，可通过 <code>yudao.sms-code</code> 配置项进行自定义：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/32.png" alt=" 配置项"></p> <h3 id="_4-2-实战案例"><a href="#_4-2-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B" class="header-anchor">#</a> 4.2 实战案例</h3> <p>以会员用户手机验证码登录为例子，讲解 SmsCodeApi 的使用。</p> <p>① 引入 <code>yudao-module-system</code> 依赖，如下图所示：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本引入 `yudao-module-system` 依赖即可，因为 `yudao-module-system-api` 已经合并到 `yudao-module-system` 中。</p></div> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/34.png" alt=" 依赖"></p> <p>② 新建对应的短信模板，如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/35.png" alt="新建短信模板"></p> <p>③ 在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/enums/sms/SmsSceneEnum.java" target="_blank" rel="noopener noreferrer">SmsSceneEnum<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中，枚举会员用户的手机号登录的场景，如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/36.png" alt="SmsSceneEnum 枚举"></p> <p>④ 使用 Spring 注入 SmsCodeApi Bean，调用对应的短信验证码的发送与使用方法。如下图所示：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/33.png" alt="调用 SmsCodeApi 方法"></p> <h2 id="_5-短信客户端"><a href="#_5-%E7%9F%AD%E4%BF%A1%E5%AE%A2%E6%88%B7%E7%AB%AF" class="header-anchor">#</a> 5. 短信客户端</h2> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/tree/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/framework/sms" target="_blank" rel="noopener noreferrer"><code>frameowrk/sms</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 短信【组件】，对接阿里云、腾讯云等短信平台，提供统一的短信客户端，提供给 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/service/sms/" target="_blank" rel="noopener noreferrer"><code>service/sms</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 短信【业务】模块来调用。</p> <h3 id="_5-1-smsclient"><a href="#_5-1-smsclient" class="header-anchor">#</a> 5.1 SmsClient</h3> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/SmsClient.java" target="_blank" rel="noopener noreferrer">SmsClient<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 接口，定义短信客户端的方法。代码如下：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/41.png" alt="SmsClient 接口"></p> <p>每个短信平台，都对应一个 SmsClient 实现类。</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/42.png" alt="SmsClient 实现"></p> <h3 id="_5-2-对接其它短信平台"><a href="#_5-2-%E5%AF%B9%E6%8E%A5%E5%85%B6%E5%AE%83%E7%9F%AD%E4%BF%A1%E5%B9%B3%E5%8F%B0" class="header-anchor">#</a> 5.2 对接其它短信平台</h3> <p>如果你想要对接其它短信平台，自定义一个 SmsClient 实现类，并使用 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/impl/SmsClientFactoryImpl.java#L73-L85" target="_blank" rel="noopener noreferrer">SmsClientFactoryImpl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行创建。代码如下：</p> <p><img src="/img/%E7%9F%AD%E4%BF%A1%E9%85%8D%E7%BD%AE/45.png" alt="SmsClientFactoryImpl 创建客户端"></p> <h2 id="_6-短信平台附录"><a href="#_6-%E7%9F%AD%E4%BF%A1%E5%B9%B3%E5%8F%B0%E9%99%84%E5%BD%95" class="header-anchor">#</a> 6. 短信平台附录</h2> <p>一般情况下，建议接入 2-3 个短信平台，避免某个短信平台故障时，影响业务的正常运行。</p> <p>例如说，手机验证码的短信平台 A 故障时，赶紧将短信验证码切换到短信平台 B 上，否则用户将无法正常登录或是注册。</p> <h3 id="_6-1-阿里云"><a href="#_6-1-%E9%98%BF%E9%87%8C%E4%BA%91" class="header-anchor">#</a> 6.1 阿里云</h3> <p>① 短信 API 的账号、密钥，可通过 <a href="https://ram.console.aliyun.com/manage/ak" target="_blank" rel="noopener noreferrer">阿里云 —— AccessKey<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 获取。</p> <p>② 短信发送回调 URL，可通过 <a href="https://dysms.console.aliyun.com/general/upward" target="_blank" rel="noopener noreferrer">阿里云 —— 短信服务 —— 通用设置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置。它对应的是 SmsCallbackController 的 <code>#receiveAliyunSmsStatus(...)</code> 地址。</p> <h3 id="_6-2-腾讯云"><a href="#_6-2-%E8%85%BE%E8%AE%AF%E4%BA%91" class="header-anchor">#</a> 6.2 腾讯云</h3> <p>① 短信 API 的账号、密钥，可通过 <a href="https://console.cloud.tencent.com/cam/capi" target="_blank" rel="noopener noreferrer">腾讯云 —— API 密钥管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 获取。</p> <div class="custom-block tip"><p class="custom-block-title">注意！！！</p> <p>腾讯云需要额外使用 <a href="https://console.cloud.tencent.com/smsv2/app-manage" target="_blank" rel="noopener noreferrer">SDKAppID<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 参数，它的账号需要采用 <code>secretId SDKAppID</code> 格式。</p> <p>例如说：在“API 密钥管理”获得了 <code>SecretId</code> 为 <code>A</code>，<code>SecretKey</code> 为 <code>B</code>，在“SDKAppID”获得了 <code>SDKAppID</code> 为 <code>18</code>，则配置短信 API 的账号为 <code>A 18</code>，短信 API 的密钥为 <code>B</code>。</p></div> <p>② 短信发送回调 URL，可通过 <a href="https://console.cloud.tencent.com/smsv2/app-setting" target="_blank" rel="noopener noreferrer">腾讯云 —— 短信 —— 基础配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置。它对应的是 SmsCallbackController 的 <code>#receiveTencentSmsStatus(...)</code> 地址。</p> <h3 id="_6-3-华为云"><a href="#_6-3-%E5%8D%8E%E4%B8%BA%E4%BA%91" class="header-anchor">#</a> 6.3 华为云</h3> <p>① 短信 API 的账号、密钥，可通过 <a href="https://console.huaweicloud.com/iam/?#/mine/accessKey" target="_blank" rel="noopener noreferrer">华为云 —— 访问密钥<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 获取。</p> <div class="custom-block tip"><p class="custom-block-title">注意！！！</p> <p>华为云需要额外使用 sender 通道号，它的账号需要采用 <code>AccessKeyId sender</code> 格式。</p> <p>例如说：在“华为云访问密钥”获得了 <code>AccessKeyId</code> 为 <code>A</code>，<code>SecretAccessKey</code> 为 <code>B</code>，在“华为云签名”获得了 <code>sender</code> 为 <code>8824060312575</code>，则配置短信 API 的账号为 <code>A 8824060312575</code>，短信 API 的密钥为 <code>B</code>。</p></div> <p>② 短信发送回调 URL，可以通过我们项目的 [系统管理 -&gt; 消息中心 -&gt; 短信管理 -&gt; 短信渠道] 菜单，配置它的“短信发送回调 URL”字段即可。它对应的是 SmsCallbackController 的 <code>#receiveHuaweiSmsStatus(...)</code> 地址。</p> <h3 id="_6-4-七牛云"><a href="#_6-4-%E4%B8%83%E7%89%9B%E4%BA%91" class="header-anchor">#</a> 6.4 七牛云</h3> <p>① 短信 API 的账号、密钥，可通过 <a href="https://portal.qiniu.com/developer/user/key" target="_blank" rel="noopener noreferrer">七牛云 —— 密钥管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 获取。</p> <p>② 短信发送回调 URL，可通过 <a href="https://portal.qiniu.com/sms/settings" target="_blank" rel="noopener noreferrer">七牛云 —— 云短信 —— 设置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置。它对应的是 SmsCallbackController 的 <code>#receiveQiniuSmsStatus(...)</code> 地址。</p> <h3 id="_6-5-更多短信平台"><a href="#_6-5-%E6%9B%B4%E5%A4%9A%E7%9F%AD%E4%BF%A1%E5%B9%B3%E5%8F%B0" class="header-anchor">#</a> 6.5 更多短信平台</h3> <p>短信平台非常的多，欢迎给我们 pull request 贡献。</p> <p>例如说：合一、云片、京东云、容联云、亿美软通、天翼云、网易云等等。</p> <p>如果你想参与，可以添加 <code>wangwenbin-server</code> 微信好，备注“短信”即可。</p></div></div>
    </div>
</body>
</html>