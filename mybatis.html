<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBatis 数据库 | ruoyi-vue-pro 开发指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .source-url {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        .content-wrapper {
            line-height: 1.8;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            background: #f6f8fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>MyBatis 数据库 | ruoyi-vue-pro 开发指南</h1>
        <div class="source-url">原始链接: <a href="https://doc.iocoder.cn/mybatis/">https://doc.iocoder.cn/mybatis/</a></div>
    </div>
    <div class="content-wrapper">
        <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">MyBatis 数据库<!----></h1>  <div class="theme-vdoing-content content__default"><p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/" target="_blank" rel="noopener noreferrer"><code>yudao-spring-boot-starter-mybatis</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 技术组件，基于 MyBatis Plus 实现数据库的操作。如果你没有学习过 MyBatis Plus，建议先阅读 <a href="https://www.iocoder.cn/Spring-Boot/MyBatis/?yudao" target="_blank" rel="noopener noreferrer">《芋道 Spring Boot MyBatis 入门 》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文章。</p> <div class="custom-block tip"><p class="custom-block-title">友情提示</p> <p>MyBatis 是最容易读懂的 Java 框架之一，感兴趣的话，可以看看艿艿写的 <a href="https://www.iocoder.cn/MyBatis/good-collection/?yudao" target="_blank" rel="noopener noreferrer">《芋道 MyBatis 源码解析》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 系列，已经有 18000 人学习过！</p></div> <h2 id="_1-实体类"><a href="#_1-%E5%AE%9E%E4%BD%93%E7%B1%BB" class="header-anchor">#</a> 1. 实体类</h2> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/dataobject/BaseDO.java" target="_blank" rel="noopener noreferrer">BaseDO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是所有数据库实体的<strong>父类</strong>，代码如下：</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseDO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 创建时间
     */</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span><span class="token constant">INSERT</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 最后更新时间
     */</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span><span class="token constant">INSERT_UPDATE</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 创建者，目前使用 AdminUserDO / MemberUserDO 的 id 编号
     *
     * 使用 String 类型的原因是，未来可能会存在非数值的情况，留好拓展性。
     */</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span><span class="token constant">INSERT</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> creator<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 更新者，目前使用 AdminUserDO / MemberUserDO 的 id 编号
     *
     * 使用 String 类型的原因是，未来可能会存在非数值的情况，留好拓展性。
     */</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token class-name">FieldFill</span><span class="token punctuation">.</span><span class="token constant">INSERT_UPDATE</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> updater<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 是否删除
     */</span>
    <span class="token annotation punctuation">@TableLogic</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> deleted<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>createTime</code> + <code>creator</code> 字段，创建人相关信息。</li> <li><code>updater</code> + <code>updateTime</code> 字段，创建人相关信息。</li> <li><code>deleted</code> 字段，逻辑删除。</li></ul> <p>对应的 SQL 字段如下：</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token identifier"><span class="token punctuation">`</span>creator<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建者'</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>updater<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新者'</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>deleted<span class="token punctuation">`</span></span> <span class="token keyword">bit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> b<span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否删除'</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_1-1-主键编号"><a href="#_1-1-%E4%B8%BB%E9%94%AE%E7%BC%96%E5%8F%B7" class="header-anchor">#</a> 1.1 主键编号</h3> <p><code>id</code> 主键编号，推荐使用 Long 型自增，原因是：</p> <ul><li>自增，保证数据库是按顺序写入，性能更加优秀。</li> <li>Long 型，避免未来业务增长，超过 Int 范围。</li></ul> <p>对应的 SQL 字段如下：</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
</code></pre></div><p>项目的 <code>id</code> <strong>默认</strong>采用数据库自增的策略，如果希望使用 Snowflake 雪花算法，可以修改 <code>application.yaml</code> 配置文件，将配置项 <code>mybatis-plus.global-config.db-config.id-type</code> 修改为 <code>ASSIGN_ID</code>。如下图所示：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/01.png" alt="配置 Snowflake 雪花算法"></p> <h3 id="_1-2-逻辑删除"><a href="#_1-2-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4" class="header-anchor">#</a> 1.2 逻辑删除</h3> <p>所有表通过 <code>deleted</code> 字段来实现逻辑删除，值为 0 表示未删除，值为 1 表示已删除，可见 <code>application.yaml</code> 配置文件的 <code>logic-delete-value</code> 和 <code>logic-not-delete-value</code> 配置项。如下图所示：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/03.png" alt="逻辑删除的配置"></p> <p>① 所有 SELECT 查询，都会自动拼接 <code>WHERE deleted = 0</code> 查询条件，过滤已经删除的记录。如果被删除的记录，只能通过在 XML 或者 <code>@SELECT</code> 来手写 SQL 语句。例如说：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/04.png" alt="不自动过滤逻辑删除"></p> <p>② 建立唯一索引时，需要额外增加 <code>delete_time</code> 字段，添加到唯一索引字段中，避免唯一索引冲突。例如说，<code>system_users</code> 使用 <code>username</code> 作为唯一索引：</p> <ul><li>未添加前：先逻辑删除了一条 <code>username = yudao</code> 的记录，然后又插入了一条 <code>username = yudao</code> 的记录时，会报索引冲突的异常。</li> <li>已添加后：先逻辑删除了一条 <code>username = yudao</code> 的记录并更新 <code>delete_time</code> 为当前时间，然后又插入一条 <code>username = yudao</code> 并且 <code>delete_time</code> 为 0 的记录，不会导致唯一索引冲突。</li></ul> <h3 id="_1-3-自动填充"><a href="#_1-3-%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85" class="header-anchor">#</a> 1.3 自动填充</h3> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/handler/DefaultDBFieldHandler.java" target="_blank" rel="noopener noreferrer">DefaultDBFieldHandler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 基于 MyBatis 自动填充机制，实现 BaseDO 通用字段的自动设置。代码如下如：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/02.png" alt="DefaultDBFieldHandler 自动填充"></p> <h3 id="_1-4-复杂-字段类型"><a href="#_1-4-%E5%A4%8D%E6%9D%82-%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B" class="header-anchor">#</a> 1.4 “复杂”字段类型</h3> <p>MyBatis Plus 提供 TypeHandler 字段类型处理器，用于 JavaType 与 JdbcType 之间的转换。示例如下：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/13.png" alt="字段处理器的示例"></p> <p>常用的字段类型处理器有：</p> <ul><li><a href="https://github.com/baomidou/mybatis-plus/blob/a3e121c27cd26cb7c546dfb88190f3b1f574dc38/mybatis-plus-extension/src/main/java/com/baomidou/mybatisplus/extension/handlers/JacksonTypeHandler.java" target="_blank" rel="noopener noreferrer">JacksonTypeHandler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：通用的 Jackson 实现 JSON 字段类型处理器。</li></ul> <p>另外，如果你后续要拓展自定义的 TypeHandler 实现，可以添加到 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/type/" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.yudao.framework.mybatis.core.type</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 包下。</p> <div class="custom-block tip"><p class="custom-block-title">注意事项：</p> <p>使用 TypeHandler 时，需要设置实体的 <code>@TableName</code> 注解的 <code>@autoResultMap = true</code>。</p></div> <h2 id="_2-编码规范"><a href="#_2-%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83" class="header-anchor">#</a> 2. 编码规范</h2> <p>① 数据库实体类放在 <code>dal.dataobject</code> 包下，以 DO 结尾；数据库访问类放在 <code>dal.mysql</code> 包下，以 Mapper 结尾。如下图所示：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本不区分 yudao-module-system-api 和 yudao-module-system-biz 子模块，代码直接合并到 yudao-module-system 模块的 src 目录下，更适合单体项目</p></div> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/17.png" alt="包规范"></p> <hr> <p>② 数据库实体类的注释要完整，特别是哪些字段是关联（外键）、枚举、冗余等等。例如说：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/18.png" alt="包规范"></p> <hr> <p>③ 禁止在 Controller、Service 中，<strong>直接</strong>进行 MyBatis Plus 操作。原因是：大量 MyBatis 操作散落在 Service 中，会导致 Service 的代码越来乱，无法聚焦业务逻辑。</p> <table><thead><tr><th></th> <th>示例</th></tr></thead> <tbody><tr><td>错误</td> <td><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/05.png" alt=""></td></tr> <tr><td>正确</td> <td><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/06.png" alt=""></td></tr></tbody></table> <p>并且，通过只允许将 MyBatis Plus 操作编写 Mapper 层，更好的实现 SELECT 查询的复用，而不是 Service 会存在很多相同且重复的 SELECT 查询的逻辑。</p> <hr> <p>④ Mapper 的 SELECT 查询方法的命名，采用 Spring Data 的 <a href="https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html" target="_blank" rel="noopener noreferrer">"Query methods"<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 策略，方法名使用 <code>selectBy查询条件</code> 规则。例如说：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/07.png" alt="SELECT 命名示例"></p> <hr> <p>⑤ 优先使用 LambdaQueryWrapper 条件构造器，使用方法获得字段名，避免手写 <code>"字段"</code> 可能写错的情况。例如说：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/08.png" alt="LambdaQueryWrapper 条件构造器"></p> <hr> <p>⑥ 简单的单表查询，优先在 Mapper 中通过 <code>default</code> 方法实现。例如说：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/11.png" alt="单表查询"></p> <h2 id="_3-crud-接口"><a href="#_3-crud-%E6%8E%A5%E5%8F%A3" class="header-anchor">#</a> 3. CRUD 接口</h2> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java" target="_blank" rel="noopener noreferrer">BaseMapperX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 接口，继承 MyBatis Plus 的 BaseMapper 接口，提供更强的 CRUD 操作能力。</p> <h3 id="_3-1-selectone"><a href="#_3-1-selectone" class="header-anchor">#</a> 3.1 selectOne</h3> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L30-L44" target="_blank" rel="noopener noreferrer"><code>#selectOne(...)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法，使用指定条件，查询单条记录。示例如下：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/09.png" alt="selectOne 示例"></p> <h3 id="_3-2-selectcount"><a href="#_3-2-selectcount" class="header-anchor">#</a> 3.2 selectCount</h3> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L46-L56" target="_blank" rel="noopener noreferrer"><code>#selectCount(...)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法，使用指定条件，查询记录的数量。示例如下：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/10.png" alt="selectCount 示例"></p> <h3 id="_3-3-selectlist"><a href="#_3-3-selectlist" class="header-anchor">#</a> 3.3 selectList</h3> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L58-L76" target="_blank" rel="noopener noreferrer"><code>#selectList(...)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法，使用指定条件，查询多条记录。示例如下：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/11.png" alt="selectList 示例"></p> <h3 id="_3-4-selectpage"><a href="#_3-4-selectpage" class="header-anchor">#</a> 3.4 selectPage</h3> <p>针对 MyBatis Plus 分页查询的二次分装，在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java" target="_blank" rel="noopener noreferrer">BaseMapperX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中实现，目的是使用项目自己的分页封装：</p> <ul><li>【入参】查询前，将项目的分页参数 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/pojo/PageParam.java" target="_blank" rel="noopener noreferrer">PageParam<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，转换成 MyBatis Plus 的 IPage 对象。</li> <li>【出参】查询后，将 MyBatis Plus 的分页结果 IPage，转换成项目的分页结果 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/pojo/PageResult.java" target="_blank" rel="noopener noreferrer">PageResult<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。代码如下图：</li></ul> <p><img src="/img/%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/01.png" alt="BaseMapperX 实现"></p> <p>具体的使用示例，可见 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/tenant/TenantMapper.java" target="_blank" rel="noopener noreferrer">TenantMapper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类中，定义 selectPage 查询方法。代码如下：</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TenantMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapperX</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TenantDO</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">default</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TenantDO</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectPage</span><span class="token punctuation">(</span><span class="token class-name">TenantPageReqVO</span> reqVO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">selectPage</span><span class="token punctuation">(</span>reqVO<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapperX</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TenantDO</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">likeIfPresent</span><span class="token punctuation">(</span><span class="token class-name">TenantDO</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">,</span> reqVO<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果 name 不为空，则进行 like 查询</span>
                <span class="token punctuation">.</span><span class="token function">likeIfPresent</span><span class="token punctuation">(</span><span class="token class-name">TenantDO</span><span class="token operator">::</span><span class="token function">getContactName</span><span class="token punctuation">,</span> reqVO<span class="token punctuation">.</span><span class="token function">getContactName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">likeIfPresent</span><span class="token punctuation">(</span><span class="token class-name">TenantDO</span><span class="token operator">::</span><span class="token function">getContactMobile</span><span class="token punctuation">,</span> reqVO<span class="token punctuation">.</span><span class="token function">getContactMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eqIfPresent</span><span class="token punctuation">(</span><span class="token class-name">TenantDO</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span> reqVO<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果 status 不为空，则进行 = 查询</span>
                <span class="token punctuation">.</span><span class="token function">betweenIfPresent</span><span class="token punctuation">(</span><span class="token class-name">TenantDO</span><span class="token operator">::</span><span class="token function">getCreateTime</span><span class="token punctuation">,</span> reqVO<span class="token punctuation">.</span><span class="token function">getBeginCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqVO<span class="token punctuation">.</span><span class="token function">getEndCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果 create 不为空，则进行 between 查询</span>
                <span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">TenantDO</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按照 id 倒序</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>完整实战，可见 <a href="/page-feature">《开发指南 —— 分页实现》</a> 文档。</p> <h3 id="_3-5-insertbatch"><a href="#_3-5-insertbatch" class="header-anchor">#</a> 3.5 insertBatch</h3> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L78-L88" target="_blank" rel="noopener noreferrer"><code>#insertBatch(...)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法，遍历数组，逐条插入数据库中，适合<strong>少量</strong>数据插入，或者对<strong>性能要求不高</strong>的场景。 示例如下：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/12.png" alt="insertBatch 示例"></p> <div class="custom-block tip"><p class="custom-block-title">为什么不使用 insertBatchSomeColumn 批量插入？</p> <ul><li>只支持 MySQL 数据库。其它 Oracle 等数据库使用会报错，可见 <a href="https://github.com/baomidou/mybatis-plus/blob/a3e121c27cd26cb7c546dfb88190f3b1f574dc38/mybatis-plus-extension/src/main/java/com/baomidou/mybatisplus/extension/injector/methods/InsertBatchSomeColumn.java" target="_blank" rel="noopener noreferrer">InsertBatchSomeColumn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 说明。</li> <li>未支持多租户。插入数据库时，多租户字段不会进行自动赋值。</li></ul></div> <h2 id="_4-批量插入"><a href="#_4-%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5" class="header-anchor">#</a> 4. 批量插入</h2> <p>绝大多数场景下，推荐使用 MyBatis Plus 提供的 IService 的 <a href="https://github.com/baomidou/mybatis-plus/blob/34ebdf6ee6/mybatis-plus-extension/src/main/java/com/baomidou/mybatisplus/extension/service/IService.java#L66-L74" target="_blank" rel="noopener noreferrer"><code>#saveBatch()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法。示例 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/src/main/java/cn/iocoder/yudao/module/system/service/permission/PermissionServiceImpl.java#L200-L230" target="_blank" rel="noopener noreferrer">PermissionServiceImpl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 如下：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/14.png" alt="saveBatch 示例"></p> <h2 id="_5-条件构造器"><a href="#_5-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8" class="header-anchor">#</a> 5. 条件构造器</h2> <p>继承 MyBatis Plus 的条件构造器，拓展了 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/query/LambdaQueryWrapperX.java" target="_blank" rel="noopener noreferrer">LambdaQueryWrapperX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/query/QueryWrapperX.java" target="_blank" rel="noopener noreferrer">QueryWrapperX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类，主要是增加 xxxIfPresent 方法，用于判断值不存在的时候，不要拼接到条件中。例如说：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/15.png" alt="xxxIfPresent 方法"></p> <p>具体的使用示例如下：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/16.png" alt="LambdaQueryWrapperX 使用示例"></p> <h2 id="_6-mapper-xml"><a href="#_6-mapper-xml" class="header-anchor">#</a> 6. Mapper XML</h2> <p>默认配置下，MyBatis Mapper XML 需要写在各 <code>yudao-module-xxx</code> 模块的 <code>resources/mapper</code> 目录下。示例 <code>TestDemoMapper.xml</code> 如下：</p> <div class="custom-block warning"><p class="custom-block-title">图片纠错：最新版本将 yudao-module-system-biz 子模块，重命名为 yudao-module-system-server 子模块，更好表达它是一个服务</p></div> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/19.png" alt="TestDemoMapper.xml 示例"></p> <p>尽量避免数据库的连表（多表）查询，而是采用多次查询，Java 内存拼接的方式替代。例如说：</p> <p><img src="/img/%E6%95%B0%E6%8D%AE%E5%BA%93MyBatis/20.png" alt="UserController 示例"></p> <h2 id="_7-字段加密"><a href="#_7-%E5%AD%97%E6%AE%B5%E5%8A%A0%E5%AF%86" class="header-anchor">#</a> 7. 字段加密</h2> <p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/type/EncryptTypeHandler.java" target="_blank" rel="noopener noreferrer">EncryptTypeHandler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，基于 <a href="https://plus.hutool.cn/apidocs6/org/dromara/hutool/crypto/symmetric/AES.html" target="_blank" rel="noopener noreferrer">Hutool AES<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现字段的解密与解密。</p> <p>例如说，<a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/src/main/java/cn/iocoder/yudao/module/infra/dal/dataobject/db/DataSourceConfigDO.java" target="_blank" rel="noopener noreferrer">数据源配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的 <code>password</code> 密码需要实现加密存储，则只需要在该字段上添加 EncryptTypeHandler 处理器。示例代码如下：</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"infra_data_source_config"</span><span class="token punctuation">,</span> autoResultMap <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// ① 添加 autoResultMap = true</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceConfigDO</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDO</span> <span class="token punctuation">{</span>

    <span class="token comment">// ... 省略其它字段</span>
    <span class="token comment">/**
     * 密码
     */</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>typeHandler <span class="token operator">=</span> <span class="token class-name">EncryptTypeHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// ② 添加 EncryptTypeHandler 处理器</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>另外，在 <code>application.yaml</code> 配置文件中，可使用 <code>mybatis-plus.encryptor.password</code> 设置加密密钥。</p> <p>字段加密后，只允许使用<strong>精准</strong>匹配，无法使用模糊匹配。示例代码如下：</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span> <span class="token comment">// 测试使用 password 查询，可以查询到数据</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// mock 数据</span>
    <span class="token class-name">DataSourceConfigDO</span> dbDataSourceConfig <span class="token operator">=</span> <span class="token function">randomPojo</span><span class="token punctuation">(</span><span class="token class-name">DataSourceConfigDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataSourceConfigMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dbDataSourceConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// @Sql: 先插入出一条存在的数据</span>

    <span class="token comment">// 调用</span>
    <span class="token class-name">DataSourceConfigDO</span> result <span class="token operator">=</span> dataSourceConfigMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token class-name">DataSourceConfigDO</span><span class="token operator">::</span><span class="token function">getPassword</span><span class="token punctuation">,</span>
            <span class="token class-name">EncryptTypeHandler</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>dbDataSourceConfig<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重点：需要使用 EncryptTypeHandler 去加密查询字段！！！</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div>
    </div>
</body>
</html>